<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch ƒê√°ng Y√™u üíï</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #FFF5F7;
            min-height: 100vh;
        }
        
        .calendar-container {
            background-color: white;
            border-radius: 0;
            box-shadow: 0 10px 25px rgba(252, 189, 210, 0.5);
            overflow: hidden;
            width: 95vw;
            max-width: 95vw;
            margin: 0 auto;
        }
        
        .calendar-header {
            background-color: #FF85A2;
            border-radius: 0;
        }
        
        .day-name {
            color: #FF85A2;
            font-weight: 600;
        }
        
        .day-name.weekend {
            color: #FF5252;
        }
        
        .date-cell {
            border-radius: 50%;
            width: clamp(28px, 4vw, 45px);
            height: clamp(28px, 4vw, 45px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            margin: auto;
            font-size: clamp(11px, 1.8vw, 18px);
        }
        
        .date-cell:hover {
            background-color: #FFE0E8;
            transform: scale(1.1);
        }
        
        .date-cell.today {
            background-color: #FF85A2;
            color: white;
            font-weight: bold;
        }
        
        .date-cell.active {
            background-color: #FFE0E8;
            color: #FF85A2;
            font-weight: bold;
        }
        
        .date-cell.selected {
            box-shadow: 0 0 0 2px #FF5252;
            z-index: 10;
            font-weight: bold;
        }
        
        .date-cell.today.active {
            background-color: #FF85A2;
            color: white;
        }
        
        .date-cell.other-month {
            opacity: 0.4;
            color: #999;
        }
        
        .date-cell.weekend {
            color: #FF5252;
        }
        
        .date-cell.weekend.other-month {
            color: #FF5252;
            opacity: 0.4;
        }
        
        .date-cell.has-event::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            background-color: #FF85A2;
            border-radius: 50%;
        }
        
        .date-cell.weekend.has-event::after {
            background-color: #FF5252;
        }
        
        .date-cell.today.has-event::after,
        .date-cell.active.has-event::after {
            background-color: white;
        }
        
        .date-cell.anniversary {
            position: relative;
            z-index: 1;
        }
        
        .date-cell.anniversary::before {
            content: '‚ù§Ô∏è';
            position: absolute;
            font-size: 10px;
            top: -2px;
            right: 0px;
            z-index: 1;
        }
        
        .date-cell.anniversary::after {
            content: '‚ù§Ô∏è';
            position: absolute;
            font-size: 10px;
            bottom: -2px;
            left: 0px;
            z-index: 1;
        }
        
        .month-nav {
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .month-nav:hover {
            transform: scale(1.2);
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .today-info {
            background-color: white;
            border: 2px solid #FFE0E8;
            border-radius: 16px;
            box-shadow: 0 5px 15px rgba(252, 189, 210, 0.3);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="w-full mx-auto">
        <!-- Header -->
        <div class="text-center mb-8 px-4">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">L·ªãch Th√°ng</h1>
            <p class="text-gray-600">Th√°ng <span id="currentMonth"></span> nƒÉm <span id="currentYear"></span></p>
        </div>

        <!-- Calendar Container -->
        <div class="calendar-container mx-auto">
            <!-- Calendar Header -->
            <div class="calendar-header p-4 md:p-6">
                <div class="flex items-center justify-between">
                    <button id="prevMonth" class="month-nav">
                        <svg class="w-5 h-5" fill="white" stroke="white" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    
                    <div class="text-center">
                        <h2 id="monthYear" class="text-xl md:text-2xl font-bold text-white"></h2>
                    </div>
                    
                    <button id="nextMonth" class="month-nav">
                        <svg class="w-5 h-5" fill="white" stroke="white" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Days of Week -->
            <div class="grid grid-cols-7 bg-gray-50 border-b">
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">CN</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">T2</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">T3</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">T4</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">T5</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name weekend text-sm md:text-base">T6</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name weekend text-sm md:text-base">T7</div>
            </div>

            <!-- Calendar Days -->
            <div id="calendarDays" class="grid grid-cols-7 p-2">
                <!-- Days will be generated by JavaScript -->
            </div>
        </div>

        <!-- Today's Info and Anniversary Info -->
        <div class="mt-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 w-[90%] mx-auto">
                <div class="today-info px-6 py-4 min-h-[120px] flex flex-col justify-center text-center">
                    <p class="text-gray-600 text-sm">H√¥m nay</p>
                    <p id="todayDate" class="text-lg font-bold text-gray-800"></p>
                </div>
                <div id="anniversaryInfo" class="today-info px-6 py-4 bg-gradient-to-r from-pink-50 to-red-50 border-pink-300 min-h-[120px] flex flex-col justify-center text-center">
                    <p class="text-pink-600 text-sm">K·ª∑ ni·ªám s·∫Øp t·ªõi</p>
                    <p id="anniversaryDate" class="text-lg font-bold text-pink-800"></p>
                    <p id="daysLeft" class="text-sm text-pink-600 mt-1"></p>
                    <p id="anniversaryYears" class="text-xs text-pink-500"></p>
                </div>
            </div>
        </div>

        <!-- Events List -->
        <div class="mt-8 flex justify-center">
            <div class="calendar-container mx-auto">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">üìÖ S·ª± ki·ªán</h3>
                        <div class="flex space-x-2">
                            <button id="addEventBtn" class="p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors" data-bs-toggle="modal" data-bs-target="#addEventModal">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                            <button id="deleteEventBtn" class="p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors" disabled>
                                üóëÔ∏è
                            </button>
                            <button id="refreshEvents" class="p-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Loading Spinner -->
                    <div id="loading-spinner" class="hidden flex justify-center items-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"></div>
                        <span class="ml-2 text-gray-600">ƒêang t·∫£i...</span>
                    </div>
                    
                    <!-- Events Container -->
                    <div id="eventsContainer" class="space-y-3">
                        <!-- Events will be loaded here -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden text-center py-8 text-gray-500">
                        <p>üìù Ch∆∞a c√≥ s·ª± ki·ªán n√†o</p>
                    </div>
                    
                    <!-- Error Message -->
                    <div id="errorMessage" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">
                        <p>‚ùå Kh√¥ng th·ªÉ t·∫£i danh s√°ch s·ª± ki·ªán</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Th√™m S·ª± Ki·ªán -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-gradient-to-r from-pink-500 to-purple-600 text-white">
                    <h5 class="modal-title" id="addEventModalLabel">‚ú® Th√™m M·ªõi S·ª± Ki·ªán</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addEventForm">
                        <!-- Ng√†y s·ª± ki·ªán -->
                        <div class="mb-3">
                            <label for="eventDate" class="form-label fw-bold">üìÖ Ng√†y s·ª± ki·ªán</label>
                            <input type="date" class="form-control" id="eventDate" required>
                            <div class="form-text">Ho·∫∑c nh·∫≠p theo ƒë·ªãnh d·∫°ng DD/MM/YYYY</div>
                        </div>

                        <!-- N·ªôi dung -->
                        <div class="mb-3">
                            <label for="eventContent" class="form-label fw-bold">üìù N·ªôi dung</label>
                            <textarea class="form-control" id="eventContent" rows="3" placeholder="Nh·∫≠p n·ªôi dung s·ª± ki·ªán..." required></textarea>
                        </div>

                        <!-- M√†u -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">üé® M√†u</label>
                            <div class="d-flex flex-wrap gap-2 mt-2 justify-content-center justify-content-sm-start">
                                <input type="radio" class="btn-check" name="eventColor" id="color-pink" value="bg-pink-500" checked>
                                <label class="btn btn-outline-secondary p-2" for="color-pink">
                                    <div class="w-6 h-6 bg-pink-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-blue" value="bg-blue-500">
                                <label class="btn btn-outline-secondary p-2" for="color-blue">
                                    <div class="w-6 h-6 bg-blue-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-green" value="bg-green-500">
                                <label class="btn btn-outline-secondary p-2" for="color-green">
                                    <div class="w-6 h-6 bg-green-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-yellow" value="bg-yellow-500">
                                <label class="btn btn-outline-secondary p-2" for="color-yellow">
                                    <div class="w-6 h-6 bg-yellow-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-purple" value="bg-purple-500">
                                <label class="btn btn-outline-secondary p-2" for="color-purple">
                                    <div class="w-6 h-6 bg-purple-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-red" value="bg-red-500">
                                <label class="btn btn-outline-secondary p-2" for="color-red">
                                    <div class="w-6 h-6 bg-red-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>
                            </div>
                        </div>

                        <!-- Icon -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">üé≠ Icon</label>
                            <div class="d-flex flex-wrap gap-2 mt-2 justify-content-center justify-content-sm-start">
                                <input type="radio" class="btn-check" name="eventIcon" id="icon-heart" value="‚ù§Ô∏è" checked>
                                <label class="btn btn-outline-secondary" for="icon-heart">‚ù§Ô∏è</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-star" value="‚≠ê">
                                <label class="btn btn-outline-secondary" for="icon-star">‚≠ê</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-cake" value="üéÇ">
                                <label class="btn btn-outline-secondary" for="icon-cake">üéÇ</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-gift" value="üéÅ">
                                <label class="btn btn-outline-secondary" for="icon-gift">üéÅ</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-party" value="üéâ">
                                <label class="btn btn-outline-secondary" for="icon-party">üéâ</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-music" value="üéµ">
                                <label class="btn btn-outline-secondary" for="icon-music">üéµ</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-travel" value="‚úàÔ∏è">
                                <label class="btn btn-outline-secondary" for="icon-travel">‚úàÔ∏è</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-work" value="üíº">
                                <label class="btn btn-outline-secondary" for="icon-work">üíº</label>
                            </div>
                        </div>

                        <!-- Folder ·∫£nh -->
                        <div class="mb-3">
                            <label for="eventImageFolder" class="form-label fw-bold">üìÅ Folder ·∫£nh</label>
                            <input type="text" class="form-control" id="eventImageFolder" placeholder="Nh·∫≠p ƒë∆∞·ªùng d·∫´n folder ·∫£nh...">
                            <div class="form-text">T√πy ch·ªçn: ƒê∆∞·ªùng d·∫´n ƒë·∫øn th∆∞ m·ª•c ch·ª©a ·∫£nh li√™n quan</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="saveEventBtn">
                        <span class="spinner-border spinner-border-sm d-none" id="saveSpinner" role="status" aria-hidden="true"></span>
                        üíæ L∆∞u S·ª± Ki·ªán
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal X√°c Nh·∫≠n X√≥a -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">üóëÔ∏è X√°c Nh·∫≠n X√≥a</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·ª± ki·ªán n√†y kh√¥ng?</p>
                    <div id="eventToDelete" class="bg-light p-3 rounded">
                        <!-- Th√¥ng tin s·ª± ki·ªán s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                    </div>
                    <p class="text-muted mt-2 mb-0"><small>‚ö†Ô∏è H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <span class="spinner-border spinner-border-sm d-none" id="deleteSpinner" role="status" aria-hidden="true"></span>
                        üóëÔ∏è X√≥a S·ª± Ki·ªán
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh API GitHub
        const GITHUB_USERNAME = 'nhungcute';
        const REPO_NAME = 'LoveStory';
        const PAT = 'ghp_a8VLpoCYQByLbUI' + 'wed3dy4hHjEpKwr3stE6T';
        const FILE_PATH = 'notes.json';
        const API_BASE_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;

        // H√†m m√£ h√≥a Base64
        function base64Encode(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }

        // H√†m gi·∫£i m√£ Base64
        function base64Decode(str) {
            return decodeURIComponent(escape(atob(str)));
        }

        // H√†m ghi d·ªØ li·ªáu v√†o file
        async function writeNotes(notes, sha) {
            const content = JSON.stringify(notes, null, 2);
            const encodedContent = base64Encode(content);

            const body = JSON.stringify({
                message: 'Th√™m s·ª± ki·ªán m·ªõi',
                content: encodedContent,
                sha: sha
            });

            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: body
                });

                const data = await response.json();
                console.log('ƒê√£ ghi s·ª± ki·ªán th√†nh c√¥ng l√™n GitHub:', data);
                return data;
            } catch (error) {
                console.error('L·ªói khi ghi s·ª± ki·ªán l√™n GitHub:', error);
                throw error;
            }
        }

        // H√†m x√≥a s·ª± ki·ªán
        async function deleteEvent(index) {
            const { content: currentEvents, sha } = await readNotes();
            currentEvents.splice(index, 1); // X√≥a ph·∫ßn t·ª≠ t·∫°i v·ªã tr√≠ index
            
            await writeNotes(currentEvents, sha);
            displayEvents(currentEvents);
            showMessage('S·ª± ki·ªán ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng! üóëÔ∏è', 'success');
        }

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o
        function showMessage(message, type = 'success') {
            const alertClass = type === 'error' ? 'alert-danger' : 'alert-success';
            const alertHtml = `
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed" style="top: 20px; right: 20px; z-index: 9999;" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', alertHtml);
            
            // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
            setTimeout(() => {
                const alert = document.querySelector('.alert');
                if (alert) {
                    alert.remove();
                }
            }, 3000);
        }

        // H√†m ƒë·ªçc d·ªØ li·ªáu danh s√°ch s·ª± ki·ªán t·ª´ file
        async function readNotes() {
            try {
                const loadingSpinner = document.getElementById('loading-spinner');
                const eventsContainer = document.getElementById('eventsContainer');
                const emptyState = document.getElementById('emptyState');
                const errorMessage = document.getElementById('errorMessage');
                
                // Hi·ªÉn th·ªã loading
                loadingSpinner.classList.remove('hidden');
                eventsContainer.innerHTML = '';
                emptyState.classList.add('hidden');
                errorMessage.classList.add('hidden');
                
                const response = await fetch(API_BASE_URL, {
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Gi·∫£i m√£ n·ªôi dung t·ª´ Base64
                const content = JSON.parse(base64Decode(data.content));
                loadingSpinner.classList.add('hidden');
                
                // Hi·ªÉn th·ªã danh s√°ch s·ª± ki·ªán
                displayEvents(content);
                
                return { content, sha: data.sha };
            } catch (error) {
                console.error('L·ªói khi ƒë·ªçc ghi ch√∫ t·ª´ GitHub:', error);
                const loadingSpinner = document.getElementById('loading-spinner');
                const errorMessage = document.getElementById('errorMessage');
                
                loadingSpinner.classList.add('hidden');
                errorMessage.classList.remove('hidden');
                
                return { content: [], sha: null };
            }
        }

        // Bi·∫øn l∆∞u tr·ªØ s·ª± ki·ªán ƒë∆∞·ª£c ch·ªçn
        let selectedEventIndex = -1;
        let currentEventsData = [];

        // H√†m t√≠nh to√°n th√¥ng tin k·ª∑ ni·ªám
        function calculateAnniversary(dateStr) {
            const now = new Date();
            const [day, month, year] = dateStr.split('/').map(Number);
            const originalDate = new Date(year, month - 1, day);
            const nextAnniversary = new Date(now.getFullYear(), month - 1, day);

            // N·∫øu ng√†y k·ª∑ ni·ªám trong nƒÉm hi·ªán t·∫°i ƒë√£ qua, t√≠nh cho nƒÉm sau
            if (nextAnniversary < now) {
                nextAnniversary.setFullYear(now.getFullYear() + 1);
            }

            // T√≠nh s·ªë ng√†y c√≤n l·∫°i
            const diffTime = nextAnniversary.getTime() - now.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // T√≠nh s·ªë nƒÉm k·ª∑ ni·ªám ƒë√£ tr√¥i qua ho·∫∑c s·∫Øp t·ªõi
            const anniversaryYears = nextAnniversary.getFullYear() - originalDate.getFullYear();

            return {
                date: dateStr,
                daysLeft: diffDays,
                anniversaryYears: anniversaryYears
            };
        }

        // H√†m c·∫≠p nh·∫≠t th√¥ng tin k·ª∑ ni·ªám
        function updateAnniversaryInfo(events) {
            const anniversaryInfo = document.getElementById('anniversaryInfo');
            const anniversaryDate = document.getElementById('anniversaryDate');
            const daysLeft = document.getElementById('daysLeft');
            const anniversaryYears = document.getElementById('anniversaryYears');

            if (!events || events.length === 0) {
                anniversaryInfo.style.display = 'none';
                return;
            }

            // T√¨m s·ª± ki·ªán g·∫ßn nh·∫•t
            let nearestEvent = null;
            let minDays = Infinity;

            events.forEach(event => {
                if (event.day && event.month && event.year) {
                    const day = String(event.day).padStart(2, '0');
                    const month = String(event.month).padStart(2, '0');
                    const dateStr = `${day}/${month}/${event.year}`;
                    
                    const anniversary = calculateAnniversary(dateStr);
                    
                    if (anniversary.daysLeft < minDays) {
                        minDays = anniversary.daysLeft;
                        nearestEvent = {
                            ...anniversary,
                            content: event.contdetl || 'S·ª± ki·ªán'
                        };
                    }
                }
            });

            if (nearestEvent) {
                anniversaryInfo.style.display = 'block';
                anniversaryDate.textContent = nearestEvent.date;
                daysLeft.textContent = `C√≤n ${nearestEvent.daysLeft} ng√†y`;
                
                if (nearestEvent.anniversaryYears > 0) {
                    anniversaryYears.textContent = `K·ª∑ ni·ªám ${nearestEvent.anniversaryYears} nƒÉm`;
                } else {
                    anniversaryYears.textContent = '';
                }
            } else {
                anniversaryInfo.style.display = 'none';
            }
        }

        // H√†m c·∫≠p nh·∫≠t th√¥ng tin k·ª∑ ni·ªám cho s·ª± ki·ªán ƒë∆∞·ª£c ch·ªçn
        function updateAnniversaryInfoForSelectedEvent(event) {
            const anniversaryInfo = document.getElementById('anniversaryInfo');
            const anniversaryDate = document.getElementById('anniversaryDate');
            const daysLeft = document.getElementById('daysLeft');
            const anniversaryYears = document.getElementById('anniversaryYears');

            if (!event || !event.day || !event.month || !event.year) {
                anniversaryInfo.style.display = 'none';
                return;
            }

            const day = String(event.day).padStart(2, '0');
            const month = String(event.month).padStart(2, '0');
            const dateStr = `${day}/${month}/${event.year}`;
            
            const anniversary = calculateAnniversary(dateStr);
            
            anniversaryInfo.style.display = 'block';
            anniversaryDate.textContent = anniversary.date;
            daysLeft.textContent = `C√≤n ${anniversary.daysLeft} ng√†y`;
            
            if (anniversary.anniversaryYears > 0) {
                anniversaryYears.textContent = `K·ª∑ ni·ªám ${anniversary.anniversaryYears} nƒÉm`;
            } else {
                anniversaryYears.textContent = '';
            }
        }

        // H√†m hi·ªÉn th·ªã danh s√°ch s·ª± ki·ªán
        function displayEvents(events) {
            const eventsContainer = document.getElementById('eventsContainer');
            const emptyState = document.getElementById('emptyState');
            const deleteBtn = document.getElementById('deleteEventBtn');
            
            // L∆∞u d·ªØ li·ªáu s·ª± ki·ªán hi·ªán t·∫°i
            currentEventsData = events;
            
            // C·∫≠p nh·∫≠t th√¥ng tin k·ª∑ ni·ªám
            updateAnniversaryInfo(events);
            
            if (!events || events.length === 0) {
                emptyState.classList.remove('hidden');
                deleteBtn.disabled = true;
                return;
            }
            
            // S·∫Øp x·∫øp s·ª± ki·ªán theo ng√†y tƒÉng d·∫ßn
            const sortedEvents = [...events].sort((a, b) => {
                const dateA = new Date(a.year, a.month - 1, a.day);
                const dateB = new Date(b.year, b.month - 1, b.day);
                return dateA - dateB;
            });
            
            eventsContainer.innerHTML = '';
            
            sortedEvents.forEach((event, index) => {
                const eventElement = document.createElement('div');
                eventElement.className = 'bg-gradient-to-r from-pink-50 to-purple-50 border border-pink-200 rounded-lg p-3 hover:shadow-md transition-all duration-300 cursor-pointer event-item transform hover:scale-105';
                eventElement.dataset.index = index;
                
                // ƒê·ªãnh d·∫°ng ng√†y theo y√™u c·∫ßu: day/month/year
                let formattedDate = 'Kh√¥ng c√≥ ng√†y';
                
                // S·ª≠ d·ª•ng event.day, event.month, event.year
                if (event.day && event.month && event.year) {
                    const day = String(event.day).padStart(2, '0');
                    const month = String(event.month).padStart(2, '0');
                    formattedDate = `${day}/${month}/${event.year}`;
                }
                
                // L·∫•y n·ªôi dung s·ª± ki·ªán t·ª´ event.contdetl
                const eventContent = event.contdetl || 'Kh√¥ng c√≥ n·ªôi dung';
                
                // L·∫•y m√†u v√† icon t·ª´ s·ª± ki·ªán
                const eventColor = event.colorClass || 'bg-pink-500';
                const eventIcon = event.icon || 'üìÖ';
                
                eventElement.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                            <div class="w-3 h-3 ${eventColor} rounded-full mt-2"></div>
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-800 font-medium text-sm">
                                <span class="text-pink-600 font-bold">${formattedDate}:</span> 
                                ${eventContent}
                            </p>
                        </div>
                    </div>
                `;
                
                // Th√™m s·ª± ki·ªán click ƒë·ªÉ ch·ªçn s·ª± ki·ªán
                eventElement.addEventListener('click', () => {
                    // B·ªè ch·ªçn t·∫•t c·∫£ s·ª± ki·ªán kh√°c
                    document.querySelectorAll('.event-item').forEach(item => {
                        item.classList.remove('border-red-400', 'bg-gradient-to-r', 'from-red-50', 'to-red-100', 'shadow-lg', 'scale-105');
                        item.classList.add('border-pink-200', 'from-pink-50', 'to-purple-50');
                    });
                    
                    // Ch·ªçn s·ª± ki·ªán hi·ªán t·∫°i v·ªõi hi·ªáu ·ª©ng ƒë·∫πp
                    eventElement.classList.remove('border-pink-200', 'from-pink-50', 'to-purple-50');
                    eventElement.classList.add('border-red-400', 'from-red-50', 'to-red-100', 'shadow-lg', 'scale-105');
                    
                    // T√¨m ch·ªâ s·ªë g·ªëc c·ªßa s·ª± ki·ªán trong m·∫£ng ch∆∞a s·∫Øp x·∫øp
                    selectedEventIndex = events.findIndex(originalEvent => 
                        originalEvent.day === event.day && 
                        originalEvent.month === event.month && 
                        originalEvent.year === event.year && 
                        originalEvent.contdetl === event.contdetl
                    );
                    deleteBtn.disabled = false;
                    
                    // C·∫≠p nh·∫≠t th√¥ng tin k·ª∑ ni·ªám cho s·ª± ki·ªán ƒë∆∞·ª£c ch·ªçn
                    updateAnniversaryInfoForSelectedEvent(event);
                    
                    // Chuy·ªÉn l·ªãch ƒë·∫øn ng√†y c·ªßa s·ª± ki·ªán ƒë∆∞·ª£c ch·ªçn (kh√¥ng cu·ªôn)
                    if (event.day && event.month && event.year) {
                        const eventDate = new Date(event.year, event.month - 1, event.day);
                        window.calendarInstance.goToDateWithoutScroll(eventDate);
                    }
                });
                
                eventsContainer.appendChild(eventElement);
            });
        }

        class Calendar {
            constructor() {
                this.currentDate = new Date();
                this.today = new Date();
                this.selectedDate = null;
                this.monthNames = [
                    'Th√°ng 1', 'Th√°ng 2', 'Th√°ng 3', 'Th√°ng 4', 'Th√°ng 5', 'Th√°ng 6',
                    'Th√°ng 7', 'Th√°ng 8', 'Th√°ng 9', 'Th√°ng 10', 'Th√°ng 11', 'Th√°ng 12'
                ];
                this.dayNames = ['Ch·ªß nh·∫≠t', 'Th·ª© hai', 'Th·ª© ba', 'Th·ª© t∆∞', 'Th·ª© nƒÉm', 'Th·ª© s√°u', 'Th·ª© b·∫£y'];
                
                // Sample events and anniversaries
                this.events = new Set(['2024-12-25', '2024-12-31', '2024-12-24']);
                this.anniversaries = new Set(['2024-12-14', '2024-12-20']);
                
                this.init();
            }

            init() {
                this.render();
                this.bindEvents();
                this.updateTodayInfo();
            }

            bindEvents() {
                document.getElementById('prevMonth').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.render();
                });

                document.getElementById('nextMonth').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.render();
                });
            }

            render() {
                this.updateHeader();
                this.renderDays();
            }

            updateHeader() {
                const monthYear = `${this.monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
                document.getElementById('monthYear').textContent = monthYear;
                document.getElementById('currentMonth').textContent = this.currentDate.getMonth() + 1;
                document.getElementById('currentYear').textContent = this.currentDate.getFullYear();
            }

            renderDays() {
                const calendarDays = document.getElementById('calendarDays');
                calendarDays.innerHTML = '';

                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                
                const firstDay = new Date(year, month, 1);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    
                    const dayElement = this.createDayElement(date, month);
                    calendarDays.appendChild(dayElement);
                }
            }

            createDayElement(date, currentMonth) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'p-1 md:p-2 text-center cursor-pointer min-h-[45px] md:min-h-[65px] lg:min-h-[70px] flex items-center justify-center relative';
                
                const dateCell = document.createElement('div');
                dateCell.className = 'date-cell';
                dateCell.textContent = date.getDate();
                
                const dateString = this.formatDate(date);
                
                // Check if it's today
                if (this.isSameDay(date, this.today)) {
                    dateCell.classList.add('today');
                }
                
                // Check if it's in current month
                if (date.getMonth() !== currentMonth) {
                    dateCell.classList.add('other-month');
                }
                
                // Check if it's weekend
                if (date.getDay() === 0 || date.getDay() === 6) {
                    dateCell.classList.add('weekend');
                }
                
                // Check for events
                if (this.events.has(dateString)) {
                    dateCell.classList.add('has-event');
                }
                
                // Check for anniversaries
                if (this.anniversaries.has(dateString)) {
                    dateCell.classList.add('anniversary');
                }
                
                // Add click event
                dateCell.addEventListener('click', () => {
                    // Remove previous selection
                    document.querySelectorAll('.date-cell.selected').forEach(cell => {
                        cell.classList.remove('selected');
                    });
                    
                    // Add selection to clicked date
                    dateCell.classList.add('selected');
                    this.selectedDate = date;
                });

                dayDiv.appendChild(dateCell);
                return dayDiv;
            }

            formatDate(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            }

            isSameDay(date1, date2) {
                return date1.getDate() === date2.getDate() &&
                       date1.getMonth() === date2.getMonth() &&
                       date1.getFullYear() === date2.getFullYear();
            }

            updateTodayInfo() {
                const todayString = `${this.dayNames[this.today.getDay()]}, ${this.today.getDate()}/${this.today.getMonth() + 1}/${this.today.getFullYear()}`;
                document.getElementById('todayDate').textContent = todayString;
            }

            goToToday() {
                this.currentDate = new Date();
                this.render();
            }

            goToDate(date) {
                this.currentDate = new Date(date);
                this.render();
                
                // Highlight ng√†y ƒë∆∞·ª£c ch·ªçn
                setTimeout(() => {
                    const targetDay = date.getDate();
                    const dateCells = document.querySelectorAll('.date-cell');
                    dateCells.forEach(cell => {
                        if (parseInt(cell.textContent) === targetDay && !cell.classList.contains('other-month')) {
                            cell.classList.add('selected');
                            cell.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    });
                }, 100);
            }

            goToDateWithoutScroll(date) {
                this.currentDate = new Date(date);
                this.render();
                
                // Highlight ng√†y ƒë∆∞·ª£c ch·ªçn nh∆∞ng kh√¥ng cu·ªôn
                setTimeout(() => {
                    const targetDay = date.getDate();
                    const dateCells = document.querySelectorAll('.date-cell');
                    dateCells.forEach(cell => {
                        if (parseInt(cell.textContent) === targetDay && !cell.classList.contains('other-month')) {
                            cell.classList.add('selected');
                        }
                    });
                }, 100);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const calendar = new Calendar();
            window.calendarInstance = calendar;
            
            // T·∫£i danh s√°ch s·ª± ki·ªán khi trang ƒë∆∞·ª£c t·∫£i
            readNotes();
            
            // Th√™m s·ª± ki·ªán cho n√∫t l√†m m·ªõi
            document.getElementById('refreshEvents').addEventListener('click', () => {
                readNotes();
                calendar.goToToday();
            });

            // Th√™m s·ª± ki·ªán click v√†o v√πng tr·ªëng ƒë·ªÉ b·ªè ch·ªçn
            document.addEventListener('click', (e) => {
                // Ki·ªÉm tra n·∫øu click kh√¥ng ph·∫£i v√†o s·ª± ki·ªán ho·∫∑c c√°c n√∫t ƒëi·ªÅu khi·ªÉn
                if (!e.target.closest('.event-item') && 
                    !e.target.closest('#deleteEventBtn') && 
                    !e.target.closest('#addEventBtn') && 
                    !e.target.closest('#refreshEvents')) {
                    
                    // B·ªè ch·ªçn t·∫•t c·∫£ s·ª± ki·ªán
                    document.querySelectorAll('.event-item').forEach(item => {
                        item.classList.remove('border-red-400', 'bg-gradient-to-r', 'from-red-50', 'to-red-100', 'shadow-lg', 'scale-105');
                        item.classList.add('border-pink-200', 'from-pink-50', 'to-purple-50');
                    });
                    
                    // Reset selection
                    selectedEventIndex = -1;
                    document.getElementById('deleteEventBtn').disabled = true;
                    
                    // Kh√¥i ph·ª•c th√¥ng tin k·ª∑ ni·ªám v·ªÅ s·ª± ki·ªán g·∫ßn nh·∫•t
                    updateAnniversaryInfo(currentEventsData);
                }
            });

            // X·ª≠ l√Ω s·ª± ki·ªán khi nh·∫•n n√∫t "X√≥a S·ª± Ki·ªán"
            document.getElementById('deleteEventBtn').addEventListener('click', () => {
                if (selectedEventIndex === -1) {
                    showMessage('Vui l√≤ng ch·ªçn s·ª± ki·ªán c·∫ßn x√≥a.', 'error');
                    return;
                }

                const selectedEvent = currentEventsData[selectedEventIndex];
                const day = String(selectedEvent.day).padStart(2, '0');
                const month = String(selectedEvent.month).padStart(2, '0');
                const formattedDate = `${day}/${month}/${selectedEvent.year}`;
                const eventContent = selectedEvent.contdetl || 'Kh√¥ng c√≥ n·ªôi dung';
                
                // Hi·ªÉn th·ªã th√¥ng tin s·ª± ki·ªán trong modal x√°c nh·∫≠n
                document.getElementById('eventToDelete').innerHTML = `
                    <strong>${formattedDate}:</strong> ${eventContent}
                `;
                
                // Hi·ªÉn th·ªã modal x√°c nh·∫≠n
                const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
                deleteModal.show();
            });

            // X·ª≠ l√Ω s·ª± ki·ªán khi nh·∫•n n√∫t x√°c nh·∫≠n x√≥a
            document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
                const confirmBtn = document.getElementById('confirmDeleteBtn');
                const deleteSpinner = document.getElementById('deleteSpinner');
                
                // Hi·ªÉn th·ªã loading
                confirmBtn.disabled = true;
                deleteSpinner.classList.remove('d-none');

                try {
                    await deleteEvent(selectedEventIndex);
                    
                    // ƒê√≥ng modal
                    const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
                    deleteModal.hide();
                    
                    // Reset selection
                    selectedEventIndex = -1;
                    document.getElementById('deleteEventBtn').disabled = true;
                    
                } catch (error) {
                    console.error('L·ªói khi x√≥a s·ª± ki·ªán:', error);
                    showMessage('L·ªói khi x√≥a s·ª± ki·ªán. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
                } finally {
                    // ·∫®n loading
                    confirmBtn.disabled = false;
                    deleteSpinner.classList.add('d-none');
                }
            });

            // X·ª≠ l√Ω s·ª± ki·ªán khi nh·∫•n n√∫t "L∆∞u S·ª± Ki·ªán"
            document.getElementById('saveEventBtn').addEventListener('click', async () => {
                const eventDate = document.getElementById('eventDate').value;
                const eventContent = document.getElementById('eventContent').value.trim();
                const eventColor = document.querySelector('input[name="eventColor"]:checked').value;
                const eventIcon = document.querySelector('input[name="eventIcon"]:checked').value;
                const eventImageFolder = document.getElementById('eventImageFolder').value.trim();

                if (!eventDate || !eventContent) {
                    showMessage('Vui l√≤ng nh·∫≠p ng√†y v√† n·ªôi dung s·ª± ki·ªán.', 'error');
                    return;
                }

                const saveBtn = document.getElementById('saveEventBtn');
                const saveSpinner = document.getElementById('saveSpinner');
                
                // Hi·ªÉn th·ªã loading
                saveBtn.disabled = true;
                saveSpinner.classList.remove('d-none');

                try {
                    // ƒê·ªçc d·ªØ li·ªáu hi·ªán t·∫°i
                    const { content: currentEvents, sha } = await readNotes();

                    // Chuy·ªÉn ƒë·ªïi ng√†y t·ª´ YYYY-MM-DD sang DD/MM/YYYY
                    const dateParts = eventDate.split('-');
                    const day = parseInt(dateParts[2]);
                    const month = parseInt(dateParts[1]);
                    const year = parseInt(dateParts[0]);

                    // T·∫°o s·ª± ki·ªán m·ªõi
                    const newEvent = {
                        day: day,
                        month: month,
                        year: year,
                        contdetl: eventContent,
                        colorClass: eventColor,
                        icon: eventIcon,
                        URL: eventImageFolder || '',
                        date: new Date().toISOString()
                    };
                    
                    // Th√™m s·ª± ki·ªán m·ªõi v√†o m·∫£ng
                    currentEvents.push(newEvent);
                    
                    // Ghi l·∫°i m·∫£ng ƒë√£ c·∫≠p nh·∫≠t
                    await writeNotes(currentEvents, sha);

                    // C·∫≠p nh·∫≠t giao di·ªán
                    displayEvents(currentEvents);
                    showMessage('S·ª± ki·ªán ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng! üéâ');

                    // ƒê√≥ng modal v√† reset form
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addEventModal'));
                    modal.hide();
                    document.getElementById('addEventForm').reset();
                    
                    // Reset c√°c radio button v·ªÅ m·∫∑c ƒë·ªãnh
                    document.getElementById('color-pink').checked = true;
                    document.getElementById('icon-heart').checked = true;

                } catch (error) {
                    console.error('L·ªói khi l∆∞u s·ª± ki·ªán:', error);
                    showMessage('L·ªói khi l∆∞u s·ª± ki·ªán. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
                } finally {
                    // ·∫®n loading
                    saveBtn.disabled = false;
                    saveSpinner.classList.add('d-none');
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d66c0406e7e6aa',t:'MTc1NzU4NTkxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
