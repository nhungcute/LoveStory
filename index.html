<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Story - Ứng Dụng Quản Lý Kỷ Niệm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            background: linear-gradient(135deg, #006B68 0%, #FFC62F 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        :root {
            --primary-100: #006B68;
            --primary-80: rgba(0, 107, 104, 0.8);
            --primary-60: rgba(0, 107, 104, 0.6);
            --primary-50: rgba(0, 107, 104, 0.5);
            --primary-30: rgba(0, 107, 104, 0.3);
            --accent-100: #FFC62F;
            --accent-80: rgba(255, 198, 47, 0.8);
            --accent-60: rgba(255, 198, 47, 0.6);
            --accent-50: rgba(255, 198, 47, 0.5);
            --accent-30: rgba(255, 198, 47, 0.3);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            color: var(--primary-100) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .nav-link {
            color: var(--primary-100) !important;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 0 5px;
            padding: 8px 16px !important;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--primary-100);
            color: white !important;
            transform: translateY(-2px);
        }

        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin: 20px;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, var(--primary-100), var(--accent-100));
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-100), var(--accent-100));
            border-radius: 10px;
            color: white;
        }

        .calendar-nav-btn {
            background: var(--primary-30);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .calendar-nav-btn:hover {
            background: var(--primary-50);
            transform: scale(1.05);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
        }

        .calendar-day:hover {
            background: var(--accent-100);
            color: white;
            transform: scale(1.1);
        }

        .calendar-day.today {
            background: var(--primary-100);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-event {
            background: var(--accent-100);
            color: var(--primary-100);
            font-weight: bold;
        }

        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 6px;
            height: 6px;
            background: var(--primary-100);
            border-radius: 50%;
        }

        .day-header {
            background: var(--primary-100);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .timeline-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .timeline-item {
            background: white;
            border-left: 4px solid var(--primary-100);
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 0 15px 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .timeline-item:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: var(--accent-100);
            border-radius: 50%;
            border: 3px solid white;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-actions {
            display: flex;
            gap: 5px;
            margin-left: 15px;
        }

        .event-date {
            color: var(--primary-100);
            font-weight: bold;
            font-size: 0.9rem;
        }

        .event-title {
            color: #333;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .event-description {
            color: #666;
            margin-bottom: 10px;
        }

        .btn-primary-custom {
            background: var(--primary-100);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary-custom:hover {
            background: var(--primary-80);
            transform: translateY(-2px);
        }

        .btn-accent-custom {
            background: var(--accent-100);
            border: none;
            color: var(--primary-100);
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-accent-custom:hover {
            background: var(--accent-80);
            transform: translateY(-2px);
        }

        .btn-icon {
            background: none;
            border: 1px solid var(--primary-30);
            color: var(--primary-100);
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: var(--primary-100);
            color: white;
            border-color: var(--primary-100);
        }

        .btn-icon.danger:hover {
            background: #dc3545;
            border-color: #dc3545;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .view-btn {
            background: #f8f9fa;
            border: 2px solid var(--primary-100);
            color: var(--primary-100);
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: var(--primary-100);
            color: white;
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .photo-gallery.list-view {
            grid-template-columns: 1fr;
        }

        .photo-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .photo-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .photo-card.list-item {
            display: flex;
            align-items: center;
            padding: 15px;
        }

        .photo-card.list-item .photo-thumbnail {
            width: 80px;
            height: 80px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .photo-thumbnail {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, var(--primary-100), var(--accent-100));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            background-size: cover;
            background-position: center;
        }

        .photo-info {
            padding: 15px;
        }

        .photo-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .photo-date {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .photo-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .interaction-buttons {
            display: flex;
            gap: 10px;
        }

        .like-btn, .comment-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .like-btn:hover {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .like-btn.liked {
            color: #e74c3c;
        }

        .comment-btn:hover {
            color: var(--primary-100);
            background: var(--primary-30);
        }

        .modal-content {
            border-radius: 15px;
            border: none;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-100), var(--accent-100));
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 12px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-100);
            box-shadow: 0 0 0 0.2rem var(--primary-30);
        }

        .activity-log {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .log-item {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-icon {
            color: var(--primary-100);
            font-size: 1.2rem;
        }

        .log-time {
            color: #666;
            font-size: 0.8rem;
        }

        .stats-card {
            background: linear-gradient(135deg, var(--primary-100), var(--accent-100));
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
        }

        .content-section {
            display: none;
            padding: 20px;
        }

        .content-section.active {
            display: block;
        }

        .auto-update-status {
            background: linear-gradient(135deg, var(--primary-100), var(--accent-100));
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .add-event-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-100), var(--accent-100));
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .add-event-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--primary-30);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .comments-section {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .comment-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-author {
            font-weight: bold;
            color: var(--primary-100);
        }

        .comment-time {
            font-size: 0.8rem;
            color: #666;
        }

        .pagination-custom .page-link {
            color: var(--primary-100);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 0 2px;
        }

        .pagination-custom .page-link:hover {
            background: var(--primary-100);
            border-color: var(--primary-100);
            color: white;
        }

        .pagination-custom .page-item.active .page-link {
            background: var(--primary-100);
            border-color: var(--primary-100);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-heart-fill me-2"></i>
                Love Story
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('calendar')">
                            <i class="bi bi-calendar3 me-1"></i>Lịch Sự Kiện
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('timeline')">
                            <i class="bi bi-clock-history me-1"></i>Timeline
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('gallery')">
                            <i class="bi bi-images me-1"></i>Thư Viện Ảnh
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('admin')">
                            <i class="bi bi-gear me-1"></i>Quản Trị
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Calendar Section -->
        <div id="calendar-section" class="content-section active">
            <div class="section-header">
                <h2><i class="bi bi-calendar3 me-2"></i>Lịch Sự Kiện Trực Quan</h2>
                <p class="mb-0">Theo dõi các ngày kỷ niệm và sự kiện quan trọng</p>
            </div>
            
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav-btn" onclick="previousMonth()">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <h4 id="current-month" class="mb-0">Tháng 12, 2024</h4>
                    <button class="calendar-nav-btn" onclick="nextMonth()">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                
                <div class="calendar-grid">
                    <div class="day-header">CN</div>
                    <div class="day-header">T2</div>
                    <div class="day-header">T3</div>
                    <div class="day-header">T4</div>
                    <div class="day-header">T5</div>
                    <div class="day-header">T6</div>
                    <div class="day-header">T7</div>
                </div>
                <div id="calendar-days" class="calendar-grid"></div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="stats-card">
                        <div class="stats-number" id="total-events">0</div>
                        <div>Tổng Sự Kiện</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="stats-card">
                        <div class="stats-number" id="upcoming-events">0</div>
                        <div>Sự Kiện Sắp Tới</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline Section -->
        <div id="timeline-section" class="content-section">
            <div class="section-header">
                <h2><i class="bi bi-clock-history me-2"></i>Quản Lý Timeline Sự Kiện</h2>
                <p class="mb-0">Thêm, chỉnh sửa và quản lý các sự kiện của bạn</p>
            </div>

            <div class="loading-spinner" id="timeline-loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Đang tải...</span>
                </div>
                <p>Đang tải dữ liệu từ GitHub...</p>
            </div>

            <div class="error-message" id="timeline-error"></div>
            <div class="success-message" id="timeline-success"></div>

            <div class="timeline-container" id="timeline-container">
                <!-- Timeline items will be loaded here -->
            </div>
        </div>

        <!-- Gallery Section -->
        <div id="gallery-section" class="content-section">
            <div class="section-header">
                <h2><i class="bi bi-images me-2"></i>Thư Viện Ảnh "Khoảnh Khắc"</h2>
                <p class="mb-0">Lưu giữ và chia sẻ những kỷ niệm đẹp nhất</p>
            </div>

            <div class="sync-status">
                <div class="status-indicator"></div>
                <span>Đồng bộ với Google Drive: <span id="last-sync">Chưa đồng bộ</span></span>
                <button class="btn btn-sm btn-accent-custom ms-auto" onclick="syncPhotos()">
                    <i class="bi bi-arrow-clockwise me-1"></i>Đồng bộ ngay
                </button>
            </div>

            <div class="view-toggle">
                <button class="view-btn active" onclick="setViewMode('grid')">
                    <i class="bi bi-grid-3x3-gap me-1"></i>Lưới
                </button>
                <button class="view-btn" onclick="setViewMode('list')">
                    <i class="bi bi-list me-1"></i>Danh sách
                </button>
            </div>

            <div class="loading-spinner" id="gallery-loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Đang tải...</span>
                </div>
                <p>Đang tải ảnh từ Google Drive...</p>
            </div>

            <div class="photo-gallery" id="photo-gallery">
                <!-- Photos will be loaded here -->
            </div>

            <nav class="mt-4">
                <ul class="pagination pagination-custom justify-content-center" id="photo-pagination">
                    <!-- Pagination will be generated here -->
                </ul>
            </nav>
        </div>

        <!-- Admin Section -->
        <div id="admin-section" class="content-section">
            <div class="section-header">
                <h2><i class="bi bi-gear me-2"></i>Quản Trị & Kỹ Thuật</h2>
                <p class="mb-0">Theo dõi hoạt động và cấu hình hệ thống</p>
            </div>

            <div class="auto-update-status">
                <h5><i class="bi bi-cloud-arrow-down me-2"></i>Trạng Thái Tự Động Cập Nhật</h5>
                <p class="mb-2">
                    <span class="status-indicator"></span>
                    <span id="auto-sync-status">Đang kiểm tra...</span>
                </p>
                <small id="next-sync-time">Cập nhật tiếp theo: Đang tính toán...</small>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h5><i class="bi bi-list-ul me-2"></i>Nhật Ký Hoạt Động</h5>
                    <div class="activity-log" id="activity-log">
                        <!-- Activity logs will be loaded here -->
                    </div>
                </div>
                <div class="col-md-6">
                    <h5><i class="bi bi-bar-chart me-2"></i>Thống Kê Hệ Thống</h5>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <div class="stats-card">
                                <div class="stats-number" id="total-photos">0</div>
                                <div>Tổng Ảnh</div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="stats-card">
                                <div class="stats-number" id="total-events-admin">0</div>
                                <div>Sự Kiện</div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="stats-card">
                                <div class="stats-number" id="total-comments">0</div>
                                <div>Bình Luận</div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="stats-card">
                                <div class="stats-number" id="total-likes">0</div>
                                <div>Lượt Thích</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Event Button -->
    <button class="add-event-btn" onclick="openAddEventModal()" title="Thêm sự kiện mới">
        <i class="bi bi-plus"></i>
    </button>

    <!-- Add Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-calendar-plus me-2"></i>Thêm Sự Kiện Mới
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addEventForm" onsubmit="addEvent(event)">
                        <div class="mb-3">
                            <label for="eventTitle" class="form-label">Tên Sự Kiện</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="eventDate" class="form-label">Ngày (DD-MM-YYYY)</label>
                            <input type="text" class="form-control" id="eventDate" placeholder="22-02-2022" required>
                        </div>
                        <div class="mb-3">
                            <label for="eventDescription" class="form-label">Mô Tả</label>
                            <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" form="addEventForm" class="btn-primary-custom">
                        <i class="bi bi-plus-circle me-1"></i>Thêm Sự Kiện
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Modal -->
    <div class="modal fade" id="photoModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="photoModalTitle">Xem Ảnh Chi Tiết</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div id="photo-display" class="text-center mb-3">
                                <img id="modal-photo-img" src="" alt="" style="max-width: 100%; max-height: 500px; border-radius: 10px;">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h6>Thông Tin Ảnh</h6>
                            <p><strong>Tên:</strong> <span id="modal-photo-name"></span></p>
                            <p><strong>Ngày:</strong> <span id="modal-photo-date"></span></p>
                            <p><strong>Kích thước:</strong> <span id="modal-photo-size"></span></p>
                            
                            <div class="interaction-buttons mb-3">
                                <button class="like-btn" id="modal-like-btn" onclick="togglePhotoLike()">
                                    <i class="bi bi-heart"></i> <span id="modal-like-count">0</span>
                                </button>
                            </div>

                            <h6>Bình Luận</h6>
                            <div class="comments-section" id="modal-comments">
                                <!-- Comments will be loaded here -->
                            </div>
                            
                            <div class="input-group">
                                <input type="text" class="form-control" id="new-comment" placeholder="Viết bình luận...">
                                <button class="btn-accent-custom" onclick="addComment()">
                                    <i class="bi bi-send"></i>
                                </button>
                            </div>

                            <div class="mt-3">
                                <button class="btn-primary-custom w-100 mb-2" onclick="downloadPhoto()">
                                    <i class="bi bi-download me-1"></i>Tải Xuống HD
                                </button>
                                <button class="btn-accent-custom w-100" onclick="sharePhoto()">
                                    <i class="bi bi-share me-1"></i>Chia Sẻ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentDate = new Date();
        let events = [];
        let photos = [];
        let comments = {};
        let logs = [];
        let config = {};
        let currentPhoto = null;
        let currentPage = 1;
        let viewMode = 'grid';
        let photosPerPage = 50;

        // Default config (fallback)
        const defaultConfig = {
            "GITHUB_USERNAME": "nhungcute",
            "REPO_NAME": "LoveStory",
            "PAT1": "ghp_a8VLpoCYQByLbUIwe",
            "PAT2": "d3dy4hHjEpKwr3stE6T",
            "FILE_PATH": "actions.json",
            "COMMENTS_FILE_PATH": "comments.json",
            "PHOTOS_METADATA_FILE_PATH": "image_data.json",
            "LOGS_FILE_PATH": "logs.json",
            "FOLDER_ID": "1B_tpWbLwlc7mqT789-g2RO9K2pYNXVav",
            "API_KEY": "AIzaSyDJddlVwOWA8vzdVNrcp70if4eOL30xjp0",
            "PHOTOS_PER_PAGE": 50,
            "AUTO_LOAD_METADATA": "true",
            "AUTO_SYNC": {
                "enabled": true,
                "frequency": "daily",
                "time": "12:45",
                "lastRun": "2025-10-06T05:45:00.335Z",
                "nextRun": "2025-10-07T05:45:00.000Z",
                "updatedAt": "2025-10-06T05:45:01.838Z"
            }
        };

        // GitHub API functions
        async function loadConfig() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/nhungcute/LoveStory/main/configApp.json');
                if (response.ok) {
                    config = await response.json();
                } else {
                    throw new Error('Config not found');
                }
            } catch (error) {
                console.warn('Using default config:', error);
                config = defaultConfig;
            }
            photosPerPage = config.PHOTOS_PER_PAGE || 50;
        }

        async function fetchFromGitHub(filePath) {
            const token = config.PAT1 + config.PAT2;
            const url = `https://api.github.com/repos/${config.GITHUB_USERNAME}/${config.REPO_NAME}/contents/${filePath}`;
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const content = atob(data.content);
                    return JSON.parse(content);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error(`Error fetching ${filePath}:`, error);
                return null;
            }
        }

        async function saveToGitHub(filePath, data, message) {
            const token = config.PAT1 + config.PAT2;
            const url = `https://api.github.com/repos/${config.GITHUB_USERNAME}/${config.REPO_NAME}/contents/${filePath}`;
            
            try {
                // Get current file to get SHA
                const currentResponse = await fetch(url, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = null;
                if (currentResponse.ok) {
                    const currentData = await currentResponse.json();
                    sha = currentData.sha;
                }
                
                const content = btoa(JSON.stringify(data, null, 2));
                const payload = {
                    message: message,
                    content: content
                };
                
                if (sha) {
                    payload.sha = sha;
                }
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                return response.ok;
            } catch (error) {
                console.error(`Error saving ${filePath}:`, error);
                return false;
            }
        }

        // Data loading functions
        async function loadEvents() {
            showLoading('timeline-loading');
            const data = await fetchFromGitHub(config.FILE_PATH);
            hideLoading('timeline-loading');
            
            if (data && Array.isArray(data)) {
                events = data.sort((a, b) => {
                    const dateA = parseDate(a.day);
                    const dateB = parseDate(b.day);
                    return dateA - dateB;
                });
                renderTimeline();
                generateCalendar();
                updateStats();
            } else {
                showError('timeline-error', 'Không thể tải dữ liệu sự kiện');
            }
        }

        async function loadPhotos() {
            showLoading('gallery-loading');
            const data = await fetchFromGitHub(config.PHOTOS_METADATA_FILE_PATH);
            hideLoading('gallery-loading');
            
            if (data && Array.isArray(data)) {
                photos = data;
                renderPhotos();
                updateStats();
            } else {
                console.warn('No photo data found');
                photos = [];
            }
        }

        async function loadComments() {
            const data = await fetchFromGitHub(config.COMMENTS_FILE_PATH);
            if (data) {
                comments = data;
            }
        }

        async function loadLogs() {
            const data = await fetchFromGitHub(config.LOGS_FILE_PATH);
            if (data && Array.isArray(data)) {
                logs = data;
                renderActivityLog();
            }
        }

        // Utility functions
        function parseDate(dateStr) {
            const parts = dateStr.split('-');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }

        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }

        function showLoading(elementId) {
            document.getElementById(elementId).style.display = 'block';
        }

        function hideLoading(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }

        // Navigation functions
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(sectionName + '-section').classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            if (sectionName === 'calendar') {
                generateCalendar();
            } else if (sectionName === 'timeline') {
                loadEvents();
            } else if (sectionName === 'gallery') {
                loadPhotos();
                loadComments();
            } else if (sectionName === 'admin') {
                loadLogs();
                updateAutoSyncStatus();
            }
        }

        // Calendar functions
        function generateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = [
                "Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6",
                "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"
            ];
            document.getElementById('current-month').textContent = `${monthNames[month]}, ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            const calendarDays = document.getElementById('calendar-days');
            calendarDays.innerHTML = '';
            
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDays.appendChild(emptyDay);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const currentDateStr = formatDate(new Date(year, month, day));
                
                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    dayElement.classList.add('today');
                }
                
                if (events.some(event => event.day === currentDateStr)) {
                    dayElement.classList.add('has-event');
                }
                
                dayElement.onclick = () => showDayEvents(currentDateStr);
                calendarDays.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        function showDayEvents(date) {
            const dayEvents = events.filter(event => event.day === date);
            if (dayEvents.length > 0) {
                alert(`Sự kiện ngày ${date}:\n${dayEvents.map(e => e.name).join('\n')}`);
            } else {
                alert(`Không có sự kiện nào trong ngày ${date}`);
            }
        }

        // Timeline functions
        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            container.innerHTML = '';
            
            events.forEach(event => {
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';
                timelineItem.innerHTML = `
                    <div class="timeline-content">
                        <div class="event-date">
                            <i class="bi bi-calendar-event me-1"></i>${event.day}
                        </div>
                        <div class="event-title">${event.name}</div>
                        <div class="event-description">${event.contdetl || ''}</div>
                    </div>
                    <div class="timeline-actions">
                        <button class="btn-icon" onclick="editEvent('${event.id || Date.now()}')" title="Chỉnh sửa">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn-icon" onclick="viewEventPhotos('${event.id || Date.now()}')" title="Xem ảnh">
                            <i class="bi bi-images"></i>
                        </button>
                        <button class="btn-icon danger" onclick="deleteEvent('${event.id || Date.now()}')" title="Xóa">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(timelineItem);
            });
        }

        // Photo gallery functions
        function renderPhotos() {
            const gallery = document.getElementById('photo-gallery');
            gallery.innerHTML = '';
            
            const startIndex = (currentPage - 1) * photosPerPage;
            const endIndex = startIndex + photosPerPage;
            const pagePhotos = photos.slice(startIndex, endIndex);
            
            pagePhotos.forEach(photo => {
                const photoCard = document.createElement('div');
                photoCard.className = 'photo-card';
                if (viewMode === 'list') {
                    photoCard.classList.add('list-item');
                }
                
                const photoComments = comments[photo.id] || { count_tim: 0, comments: [] };
                
                photoCard.innerHTML = `
                    <div class="photo-thumbnail" style="background-image: url('${photo.thumbnailLink}')">
                        ${!photo.thumbnailLink ? '<i class="bi bi-image"></i>' : ''}
                    </div>
                    <div class="photo-info">
                        <div class="photo-title">${photo.name}</div>
                        <div class="photo-date">${new Date(photo.createdTime).toLocaleDateString('vi-VN')}</div>
                        <div class="photo-actions">
                            <div class="interaction-buttons">
                                <button class="like-btn ${photoComments.count_tim > 0 ? 'liked' : ''}" onclick="toggleLike('${photo.id}', event)">
                                    <i class="bi bi-heart${photoComments.count_tim > 0 ? '-fill' : ''}"></i> 
                                    <span>${photoComments.count_tim}</span>
                                </button>
                                <button class="comment-btn" onclick="openComments('${photo.id}', event)">
                                    <i class="bi bi-chat"></i> 
                                    <span>${photoComments.comments.length}</span>
                                </button>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="downloadPhoto('${photo.id}', event)">
                                <i class="bi bi-download"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                photoCard.onclick = (e) => {
                    if (!e.target.closest('button')) {
                        openPhotoModal(photo);
                    }
                };
                
                gallery.appendChild(photoCard);
            });
            
            renderPagination();
        }

        function renderPagination() {
            const pagination = document.getElementById('photo-pagination');
            const totalPages = Math.ceil(photos.length / photosPerPage);
            
            pagination.innerHTML = '';
            
            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement('li');
                pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
                pagination.appendChild(pageItem);
            }
        }

        function setViewMode(mode) {
            viewMode = mode;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderPhotos();
        }

        function changePage(page) {
            currentPage = page;
            renderPhotos();
        }

        // Event management functions
        function openAddEventModal() {
            const modal = new bootstrap.Modal(document.getElementById('addEventModal'));
            modal.show();
        }

        async function addEvent(event) {
            event.preventDefault();
            
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const description = document.getElementById('eventDescription').value;
            
            const newEvent = {
                id: Date.now().toString(),
                name: title,
                day: date,
                contdetl: description
            };
            
            events.push(newEvent);
            
            const success = await saveToGitHub(config.FILE_PATH, events, `Add new event: ${title}`);
            
            if (success) {
                bootstrap.Modal.getInstance(document.getElementById('addEventModal')).hide();
                document.getElementById('addEventForm').reset();
                renderTimeline();
                generateCalendar();
                updateStats();
                showSuccess('timeline-success', 'Sự kiện đã được thêm thành công!');
                
                // Log activity
                await logActivity('add_event', `Thêm sự kiện mới: ${title}`);
            } else {
                showError('timeline-error', 'Không thể lưu sự kiện. Vui lòng thử lại.');
            }
        }

        function editEvent(eventId) {
            alert('Tính năng chỉnh sửa sự kiện sẽ được triển khai trong phiên bản tiếp theo!');
        }

        function viewEventPhotos(eventId) {
            alert('Tính năng xem ảnh theo sự kiện sẽ được triển khai trong phiên bản tiếp theo!');
        }

        async function deleteEvent(eventId) {
            if (confirm('Bạn có chắc chắn muốn xóa sự kiện này?')) {
                events = events.filter(event => event.id !== eventId);
                const success = await saveToGitHub(config.FILE_PATH, events, `Delete event: ${eventId}`);
                
                if (success) {
                    renderTimeline();
                    generateCalendar();
                    updateStats();
                    showSuccess('timeline-success', 'Sự kiện đã được xóa!');
                    await logActivity('delete_event', `Xóa sự kiện: ${eventId}`);
                } else {
                    showError('timeline-error', 'Không thể xóa sự kiện. Vui lòng thử lại.');
                }
            }
        }

        // Photo modal functions
        function openPhotoModal(photo) {
            currentPhoto = photo;
            const modal = new bootstrap.Modal(document.getElementById('photoModal'));
            
            document.getElementById('photoModalTitle').textContent = photo.name;
            document.getElementById('modal-photo-img').src = photo.webViewLink || photo.thumbnailLink;
            document.getElementById('modal-photo-name').textContent = photo.name;
            document.getElementById('modal-photo-date').textContent = new Date(photo.createdTime).toLocaleDateString('vi-VN');
            document.getElementById('modal-photo-size').textContent = formatFileSize(photo.size);
            
            const photoComments = comments[photo.id] || { count_tim: 0, comments: [] };
            const likeBtn = document.getElementById('modal-like-btn');
            const likeCount = document.getElementById('modal-like-count');
            
            likeBtn.className = `like-btn ${photoComments.count_tim > 0 ? 'liked' : ''}`;
            likeBtn.querySelector('i').className = `bi bi-heart${photoComments.count_tim > 0 ? '-fill' : ''}`;
            likeCount.textContent = photoComments.count_tim;
            
            renderModalComments(photoComments.comments);
            modal.show();
        }

        function renderModalComments(commentsList) {
            const commentsContainer = document.getElementById('modal-comments');
            commentsContainer.innerHTML = '';
            
            commentsList.forEach(comment => {
                const commentItem = document.createElement('div');
                commentItem.className = 'comment-item';
                commentItem.innerHTML = `
                    <div class="comment-author">${comment.author || 'Ẩn danh'}</div>
                    <div class="comment-content">${comment.text}</div>
                    <div class="comment-time">${new Date(comment.time).toLocaleDateString('vi-VN')}</div>
                `;
                commentsContainer.appendChild(commentItem);
            });
        }

        async function toggleLike(photoId, event) {
            if (event) event.stopPropagation();
            
            if (!comments[photoId]) {
                comments[photoId] = { count_tim: 0, comments: [] };
            }
            
            comments[photoId].count_tim = comments[photoId].count_tim > 0 ? 0 : 1;
            
            const success = await saveToGitHub(config.COMMENTS_FILE_PATH, comments, `Toggle like for photo: ${photoId}`);
            
            if (success) {
                renderPhotos();
                await logActivity('like_photo', `${comments[photoId].count_tim > 0 ? 'Thích' : 'Bỏ thích'} ảnh: ${photoId}`);
            }
        }

        async function togglePhotoLike() {
            if (!currentPhoto) return;
            
            if (!comments[currentPhoto.id]) {
                comments[currentPhoto.id] = { count_tim: 0, comments: [] };
            }
            
            comments[currentPhoto.id].count_tim = comments[currentPhoto.id].count_tim > 0 ? 0 : 1;
            
            const success = await saveToGitHub(config.COMMENTS_FILE_PATH, comments, `Toggle like for photo: ${currentPhoto.id}`);
            
            if (success) {
                const likeBtn = document.getElementById('modal-like-btn');
                const likeCount = document.getElementById('modal-like-count');
                const icon = likeBtn.querySelector('i');
                
                if (comments[currentPhoto.id].count_tim > 0) {
                    likeBtn.classList.add('liked');
                    icon.className = 'bi bi-heart-fill';
                } else {
                    likeBtn.classList.remove('liked');
                    icon.className = 'bi bi-heart';
                }
                
                likeCount.textContent = comments[currentPhoto.id].count_tim;
                renderPhotos();
                await logActivity('like_photo', `${comments[currentPhoto.id].count_tim > 0 ? 'Thích' : 'Bỏ thích'} ảnh: ${currentPhoto.name}`);
            }
        }

        async function addComment() {
            if (!currentPhoto) return;
            
            const commentText = document.getElementById('new-comment').value.trim();
            if (!commentText) return;
            
            if (!comments[currentPhoto.id]) {
                comments[currentPhoto.id] = { count_tim: 0, comments: [] };
            }
            
            const newComment = {
                author: 'Bạn',
                text: commentText,
                time: new Date().toISOString()
            };
            
            comments[currentPhoto.id].comments.push(newComment);
            
            const success = await saveToGitHub(config.COMMENTS_FILE_PATH, comments, `Add comment to photo: ${currentPhoto.id}`);
            
            if (success) {
                document.getElementById('new-comment').value = '';
                renderModalComments(comments[currentPhoto.id].comments);
                renderPhotos();
                await logActivity('comment_photo', `Bình luận trên ảnh: ${currentPhoto.name}`);
            }
        }

        function openComments(photoId, event) {
            event.stopPropagation();
            const photo = photos.find(p => p.id === photoId);
            if (photo) {
                openPhotoModal(photo);
            }
        }

        function downloadPhoto(photoId, event) {
            if (event) event.stopPropagation();
            const photo = photos.find(p => p.id === photoId);
            if (photo && photo.webViewLink) {
                window.open(photo.webViewLink, '_blank', 'noopener,noreferrer');
            } else {
                alert('Không thể tải xuống ảnh này!');
            }
        }

        function sharePhoto() {
            if (currentPhoto && currentPhoto.webViewLink) {
                navigator.clipboard.writeText(currentPhoto.webViewLink).then(() => {
                    alert('Đã sao chép link ảnh vào clipboard!');
                });
            }
        }

        // Sync functions
        async function syncPhotos() {
            alert('Đang đồng bộ với Google Drive...');
            // Simulate sync process
            setTimeout(() => {
                document.getElementById('last-sync').textContent = 'Vừa xong';
                alert('Đồng bộ thành công!');
                logActivity('sync_photos', 'Đồng bộ ảnh từ Google Drive');
            }, 2000);
        }

        // Admin functions
        function renderActivityLog() {
            const logContainer = document.getElementById('activity-log');
            logContainer.innerHTML = '';
            
            const recentLogs = logs.slice(-10).reverse();
            
            recentLogs.forEach(log => {
                const logItem = document.createElement('div');
                logItem.className = 'log-item';
                logItem.innerHTML = `
                    <i class="bi bi-${getLogIcon(log.action)} log-icon"></i>
                    <div>
                        <div>${log.description}</div>
                        <div class="log-time">${new Date(log.timestamp).toLocaleString('vi-VN')}</div>
                    </div>
                `;
                logContainer.appendChild(logItem);
            });
        }

        function getLogIcon(action) {
            const icons = {
                'add_event': 'plus-circle',
                'delete_event': 'trash',
                'like_photo': 'heart-fill',
                'comment_photo': 'chat',
                'sync_photos': 'cloud-download'
            };
            return icons[action] || 'info-circle';
        }

        async function logActivity(action, description) {
            const logEntry = {
                action: action,
                description: description,
                timestamp: new Date().toISOString()
            };
            
            logs.push(logEntry);
            
            // Keep only last 100 logs
            if (logs.length > 100) {
                logs = logs.slice(-100);
            }
            
            await saveToGitHub(config.LOGS_FILE_PATH, logs, `Log activity: ${action}`);
            renderActivityLog();
        }

        function updateAutoSyncStatus() {
            const autoSync = config.AUTO_SYNC;
            const statusElement = document.getElementById('auto-sync-status');
            const nextSyncElement = document.getElementById('next-sync-time');
            
            if (autoSync && autoSync.enabled) {
                statusElement.textContent = 'Hệ thống đang hoạt động bình thường';
                const nextRun = new Date(autoSync.nextRun);
                nextSyncElement.textContent = `Cập nhật tiếp theo: ${nextRun.toLocaleString('vi-VN')}`;
            } else {
                statusElement.textContent = 'Tự động cập nhật đã tắt';
                nextSyncElement.textContent = 'Không có lịch cập nhật';
            }
        }

        // Utility functions
        function updateStats() {
            document.getElementById('total-events').textContent = events.length;
            document.getElementById('total-events-admin').textContent = events.length;
            document.getElementById('total-photos').textContent = photos.length;
            
            const today = new Date();
            const upcomingEvents = events.filter(event => parseDate(event.day) > today);
            document.getElementById('upcoming-events').textContent = upcomingEvents.length;
            
            let totalComments = 0;
            let totalLikes = 0;
            Object.values(comments).forEach(comment => {
                totalComments += comment.comments.length;
                totalLikes += comment.count_tim;
            });
            
            document.getElementById('total-comments').textContent = totalComments;
            document.getElementById('total-likes').textContent = totalLikes;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            await loadConfig();
            generateCalendar();
            await loadEvents();
            updateStats();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ab6e7522b3e6ae',t:'MTc1OTgxOTQ4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
