<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Story Dashboard - Quản Lý Kỷ Niệm</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
        }

        .sidebar {
            background: linear-gradient(180deg, #2d1b69 0%, #11998e 100%);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            width: 256px;
        }



        .sidebar-text {
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .logo-text {
            transition: all 0.3s ease;
        }

        .sidebar-item {
            transition: all 0.3s ease;
            border-radius: 12px;
            margin: 4px 8px;
            display: flex;
            align-items: center;
        }

        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(8px);
        }

        .sidebar-item i {
            min-width: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .widget-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            transform-origin: 50% 50%;
        }

        .calendar-day {
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .calendar-day:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scale(1.1);
        }

        .calendar-day.has-event {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .photo-item {
            transition: all 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
        }

        .photo-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
        }

        .timeline-item {
            position: relative;
            padding-left: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 2px;
            height: 100%;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: -4px;
            top: 8px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .happiness-meter {
            background: conic-gradient(from 0deg, #ff6b6b 0%, #feca57 25%, #48dbfb 50%, #ff9ff3 75%, #54a0ff 100%);
            border-radius: 50%;
            padding: 4px;
        }

        .happiness-inner {
            background: #1a1a2e;
            border-radius: 50%;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            border-radius: 12px;
            padding: 12px 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            color: white;
        }

        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .modal-dark {
            background: rgba(0, 0, 0, 0.8);
        }

        .modal-content-dark {
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        .form-control-dark {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 8px;
        }

        .form-control-dark:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #667eea;
            color: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .form-control-dark::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 256px !important;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }


        }

        .main-content {
            margin-left: 256px;
            transition: margin-left 0.3s ease;
        }



        @media (max-width: 768px) {
            .main-content {
                margin-left: 0 !important;
            }
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="text-white">
    <!-- Sidebar -->
    <div class="sidebar fixed left-0 top-0 h-full z-50" id="sidebar">
        <div class="p-6">
            <div class="flex items-center space-x-3 mb-8">
                <div class="w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-heart text-white"></i>
                </div>
                <h1 class="text-xl font-bold logo-text">Love Dashboard</h1>
            </div>
            
            <nav class="space-y-2">
                <a href="#" class="sidebar-item active flex items-center p-3 text-white" onclick="showSection('dashboard')">
                    <i class="fas fa-home w-5 mr-3"></i>
                    <span class="sidebar-text">Dashboard</span>
                </a>
                <a href="#" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('calendar')">
                    <i class="fas fa-calendar w-5 mr-3"></i>
                    <span class="sidebar-text">Lịch Sự Kiện</span>
                </a>
                <a href="#" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('memories')">
                    <i class="fas fa-images w-5 mr-3"></i>
                    <span class="sidebar-text">Kỷ Niệm</span>
                </a>
                <a href="#" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('gallery')">
                    <i class="fas fa-camera w-5 mr-3"></i>
                    <span class="sidebar-text">Thư Viện Ảnh</span>
                </a>
                <a href="#" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('timeline')">
                    <i class="fas fa-clock w-5 mr-3"></i>
                    <span class="sidebar-text">Timeline</span>
                </a>
                <a href="#" class="sidebar-item flex items-center p-3 text-white" onclick="showSection('analytics')">
                    <i class="fas fa-chart-bar w-5 mr-3"></i>
                    <span class="sidebar-text">Thống Kê</span>
                </a>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <header class="header-gradient p-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <button class="md:hidden text-white" onclick="toggleSidebar()">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold hidden" id="pageTitle">Dashboard</h2>
            </div>
            
            <div class="flex items-center space-x-2 md:space-x-4">
                <!-- Search Box - Desktop full, Mobile icon only -->
                <div class="relative">
                    <input type="text" placeholder="Tìm kiếm..." class="search-box px-4 py-2 text-white w-32 md:w-64 hidden md:block" id="desktopSearch">
                    <i class="fas fa-search absolute right-3 top-3 text-gray-300 hidden md:block"></i>
                    <!-- Mobile search icon -->
                    <button class="w-10 h-10 bg-white bg-opacity-10 rounded-full flex items-center justify-center hover:bg-opacity-20 transition-all md:hidden" onclick="toggleMobileSearch()">
                        <i class="fas fa-search text-white text-sm"></i>
                    </button>
                </div>
                
                <!-- Notification Icon -->
                <div class="relative">
                    <button class="w-10 h-10 bg-white bg-opacity-10 rounded-full flex items-center justify-center hover:bg-opacity-20 transition-all" onclick="toggleNotifications()">
                        <i class="fas fa-bell text-white text-sm"></i>
                        <span class="notification-badge">3</span>
                    </button>
                </div>
                
                <!-- Settings Icon -->
                <div class="relative">
                    <button class="w-10 h-10 bg-white bg-opacity-10 rounded-full flex items-center justify-center hover:bg-opacity-20 transition-all" onclick="toggleSettings()">
                        <i class="fas fa-cog text-white text-sm"></i>
                    </button>
                </div>
                
                <!-- User Icon -->
                <div class="w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center cursor-pointer" onclick="toggleUserMenu()">
                    <i class="fas fa-user text-white text-sm"></i>
                </div>
            </div>
        </header>

        <!-- Notifications Dropdown -->
        <div id="notificationsDropdown" class="fixed top-16 right-4 w-80 widget-card p-4 z-50 hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-semibold text-lg">Thông Báo</h3>
                <button onclick="toggleNotifications()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-3">
                <div class="flex items-start space-x-3 p-3 bg-white bg-opacity-5 rounded-lg">
                    <div class="w-8 h-8 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-heart text-white text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium">Kỷ niệm mới được thêm</p>
                        <p class="text-xs text-gray-400">5 phút trước</p>
                    </div>
                </div>
                <div class="flex items-start space-x-3 p-3 bg-white bg-opacity-5 rounded-lg">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-teal-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-calendar text-white text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium">Sự kiện sắp tới: Ngày Valentine</p>
                        <p class="text-xs text-gray-400">1 giờ trước</p>
                    </div>
                </div>
                <div class="flex items-start space-x-3 p-3 bg-white bg-opacity-5 rounded-lg">
                    <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-yellow-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-camera text-white text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium">10 ảnh mới được tải lên</p>
                        <p class="text-xs text-gray-400">2 giờ trước</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Dropdown -->
        <div id="settingsDropdown" class="fixed top-16 right-4 w-64 widget-card p-4 z-50 hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-semibold text-lg">Cài Đặt</h3>
                <button onclick="toggleSettings()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-2">
                <button class="w-full text-left p-3 hover:bg-white hover:bg-opacity-10 rounded-lg transition-all">
                    <i class="fas fa-palette mr-3"></i>Giao diện
                </button>
                <button class="w-full text-left p-3 hover:bg-white hover:bg-opacity-10 rounded-lg transition-all">
                    <i class="fas fa-bell mr-3"></i>Thông báo
                </button>
                <button class="w-full text-left p-3 hover:bg-white hover:bg-opacity-10 rounded-lg transition-all">
                    <i class="fas fa-shield-alt mr-3"></i>Bảo mật
                </button>
                <button class="w-full text-left p-3 hover:bg-white hover:bg-opacity-10 rounded-lg transition-all">
                    <i class="fas fa-download mr-3"></i>Sao lưu dữ liệu
                </button>
                <hr class="border-gray-600 my-2">
                <button class="w-full text-left p-3 hover:bg-white hover:bg-opacity-10 rounded-lg transition-all text-red-400">
                    <i class="fas fa-sign-out-alt mr-3"></i>Đăng xuất
                </button>
            </div>
        </div>

        <!-- Mobile Search Dropdown -->
        <div id="mobileSearchDropdown" class="fixed top-16 left-4 right-4 widget-card p-4 z-50 hidden md:hidden">
            <div class="flex items-center space-x-3">
                <div class="flex-1 relative">
                    <input type="text" placeholder="Tìm kiếm kỷ niệm, sự kiện..." class="search-box px-4 py-3 text-white w-full" id="mobileSearchInput">
                    <i class="fas fa-search absolute right-3 top-4 text-gray-300"></i>
                </div>
                <button onclick="toggleMobileSearch()" class="w-10 h-10 bg-white bg-opacity-10 rounded-full flex items-center justify-center hover:bg-opacity-20 transition-all">
                    <i class="fas fa-times text-white text-sm"></i>
                </button>
            </div>
        </div>

        <!-- User Menu Dropdown -->
        <div id="userMenuDropdown" class="fixed top-16 right-4 w-48 widget-card p-4 z-50 hidden">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-user text-white text-xl"></i>
                </div>
                <p class="font-semibold">Couple Name</p>
                <p class="text-sm text-gray-400">couple@love.com</p>
            </div>
            <div class="space-y-2">
                <button class="w-full text-left p-2 hover:bg-white hover:bg-opacity-10 rounded-lg transition-all">
                    <i class="fas fa-user-edit mr-2"></i>Hồ sơ
                </button>
                <button class="w-full text-left p-2 hover:bg-white hover:bg-opacity-10 rounded-lg transition-all">
                    <i class="fas fa-heart mr-2"></i>Tài khoản đôi
                </button>
                <hr class="border-gray-600 my-2">
                <button class="w-full text-left p-2 hover:bg-white hover:bg-opacity-10 rounded-lg transition-all text-red-400">
                    <i class="fas fa-sign-out-alt mr-2"></i>Đăng xuất
                </button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="p-6">
            <!-- Stats Widgets -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="widget-card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-300 text-sm">Tổng Sự Kiện</p>
                            <p class="text-3xl font-bold text-white" id="totalEvents">24</p>
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-calendar text-white"></i>
                        </div>
                    </div>
                </div>
                
                <div class="widget-card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-300 text-sm">Ảnh Kỷ Niệm</p>
                            <p class="text-3xl font-bold text-white" id="totalPhotos">156</p>
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-red-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-images text-white"></i>
                        </div>
                    </div>
                </div>
                
                <div class="widget-card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-300 text-sm">Ngày Bên Nhau</p>
                            <p class="text-3xl font-bold text-white" id="daysTogether">365</p>
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-teal-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-heart text-white"></i>
                        </div>
                    </div>
                </div>
                
                <div class="widget-card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-300 text-sm">Mức Hạnh Phúc</p>
                            <p class="text-3xl font-bold text-white">98%</p>
                        </div>
                        <div class="happiness-meter w-12 h-12">
                            <div class="happiness-inner">
                                <i class="fas fa-smile text-yellow-400"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Rings -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="widget-card p-6 text-center">
                    <h3 class="text-lg font-semibold mb-4">Mục Tiêu Năm</h3>
                    <div class="relative w-32 h-32 mx-auto">
                        <svg class="progress-ring w-32 h-32">
                            <circle cx="64" cy="64" r="56" stroke="rgba(255,255,255,0.1)" stroke-width="8" fill="transparent"/>
                            <circle cx="64" cy="64" r="56" stroke="url(#gradient1)" stroke-width="8" fill="transparent" 
                                    stroke-dasharray="351.86" stroke-dashoffset="87.97" class="progress-ring-circle"/>
                            <defs>
                                <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#667eea"/>
                                    <stop offset="100%" style="stop-color:#764ba2"/>
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-2xl font-bold">75%</span>
                        </div>
                    </div>
                    <p class="text-gray-300 mt-2">Hoàn thành mục tiêu</p>
                </div>
                
                <div class="widget-card p-6 text-center">
                    <h3 class="text-lg font-semibold mb-4">Hoạt Động Tháng</h3>
                    <div class="relative w-32 h-32 mx-auto">
                        <svg class="progress-ring w-32 h-32">
                            <circle cx="64" cy="64" r="56" stroke="rgba(255,255,255,0.1)" stroke-width="8" fill="transparent"/>
                            <circle cx="64" cy="64" r="56" stroke="url(#gradient2)" stroke-width="8" fill="transparent" 
                                    stroke-dasharray="351.86" stroke-dashoffset="105.56" class="progress-ring-circle"/>
                            <defs>
                                <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#f093fb"/>
                                    <stop offset="100%" style="stop-color:#f5576c"/>
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-2xl font-bold">70%</span>
                        </div>
                    </div>
                    <p class="text-gray-300 mt-2">Hoạt động trong tháng</p>
                </div>
                
                <div class="widget-card p-6 text-center">
                    <h3 class="text-lg font-semibold mb-4">Kỷ Niệm Mới</h3>
                    <div class="relative w-32 h-32 mx-auto">
                        <svg class="progress-ring w-32 h-32">
                            <circle cx="64" cy="64" r="56" stroke="rgba(255,255,255,0.1)" stroke-width="8" fill="transparent"/>
                            <circle cx="64" cy="64" r="56" stroke="url(#gradient3)" stroke-width="8" fill="transparent" 
                                    stroke-dasharray="351.86" stroke-dashoffset="70.37" class="progress-ring-circle"/>
                            <defs>
                                <linearGradient id="gradient3" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#4facfe"/>
                                    <stop offset="100%" style="stop-color:#00f2fe"/>
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-2xl font-bold">80%</span>
                        </div>
                    </div>
                    <p class="text-gray-300 mt-2">Kỷ niệm được thêm</p>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="widget-card p-6">
                <h3 class="text-xl font-semibold mb-4">Hoạt Động Gần Đây</h3>
                <div class="space-y-4">
                    <div class="flex items-center space-x-4 p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-heart text-white text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium">Thêm sự kiện mới: "Ngày kỷ niệm 1 năm"</p>
                            <p class="text-gray-400 text-sm">2 giờ trước</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-teal-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-camera text-white text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium">Tải lên 5 ảnh mới vào thư viện</p>
                            <p class="text-gray-400 text-sm">1 ngày trước</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-yellow-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-comment text-white text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium">Thêm bình luận cho ảnh "Chuyến đi Đà Lạt"</p>
                            <p class="text-gray-400 text-sm">3 ngày trước</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Section -->
        <div id="calendarSection" class="p-6" style="display: none;">
            <div class="widget-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">Lịch Sự Kiện</h3>
                    <div class="flex space-x-2">
                        <button class="btn-gradient" onclick="previousMonth()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="btn-gradient" onclick="nextMonth()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="text-center mb-6">
                    <h4 class="text-xl font-semibold" id="calendarMonth"></h4>
                </div>
                
                <div class="grid grid-cols-7 gap-2 mb-4">
                    <div class="text-center font-semibold text-gray-300 py-2">CN</div>
                    <div class="text-center font-semibold text-gray-300 py-2">T2</div>
                    <div class="text-center font-semibold text-gray-300 py-2">T3</div>
                    <div class="text-center font-semibold text-gray-300 py-2">T4</div>
                    <div class="text-center font-semibold text-gray-300 py-2">T5</div>
                    <div class="text-center font-semibold text-gray-300 py-2">T6</div>
                    <div class="text-center font-semibold text-gray-300 py-2">T7</div>
                </div>
                
                <div class="grid grid-cols-7 gap-2" id="calendarDays"></div>
            </div>
        </div>

        <!-- Memories Section -->
        <div id="memoriesSection" class="p-6" style="display: none;">
            <div class="widget-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">Quản Lý Kỷ Niệm</h3>
                    <button class="btn-gradient" onclick="showAddMemoryModal()">
                        <i class="fas fa-plus mr-2"></i>Thêm Kỷ Niệm
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="memoriesList">
                    <!-- Memories will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Gallery Section -->
        <div id="gallerySection" class="p-6" style="display: none;">
            <div class="widget-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">Thư Viện Ảnh</h3>
                    <button class="btn-gradient" onclick="showAddPhotoModal()">
                        <i class="fas fa-upload mr-2"></i>Tải Ảnh Lên
                    </button>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="photoGallery">
                    <!-- Photos will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Timeline Section -->
        <div id="timelineSection" class="p-6" style="display: none;">
            <div class="widget-card p-6">
                <h3 class="text-2xl font-bold mb-6">Timeline Kỷ Niệm</h3>
                
                <div class="space-y-6" id="timelineList">
                    <!-- Timeline items will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analyticsSection" class="p-6" style="display: none;">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="widget-card p-6">
                    <h3 class="text-xl font-semibold mb-4">Thống Kê Hoạt Động</h3>
                    <canvas id="activityChart" width="400" height="200"></canvas>
                </div>
                
                <div class="widget-card p-6">
                    <h3 class="text-xl font-semibold mb-4">Phân Bố Sự Kiện</h3>
                    <canvas id="eventChart" width="400" height="200"></canvas>
                </div>
                
                <div class="widget-card p-6 lg:col-span-2">
                    <h3 class="text-xl font-semibold mb-4">Mức Độ Hạnh Phúc Theo Thời Gian</h3>
                    <canvas id="happinessChart" width="800" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Memory Modal -->
    <div id="addMemoryModal" class="fixed inset-0 modal-dark z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content-dark p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Thêm Kỷ Niệm Mới</h3>
                    <button onclick="closeModal('addMemoryModal')" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="memoryForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Tiêu đề</label>
                        <input type="text" id="memoryTitle" class="form-control-dark w-full p-3" placeholder="Nhập tiêu đề kỷ niệm">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Ngày</label>
                        <input type="date" id="memoryDate" class="form-control-dark w-full p-3">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Mô tả</label>
                        <textarea id="memoryDescription" class="form-control-dark w-full p-3 h-24" placeholder="Mô tả chi tiết về kỷ niệm"></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Loại sự kiện</label>
                        <select id="memoryType" class="form-control-dark w-full p-3">
                            <option value="anniversary">Kỷ niệm</option>
                            <option value="date">Hẹn hò</option>
                            <option value="travel">Du lịch</option>
                            <option value="special">Đặc biệt</option>
                        </select>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button type="button" onclick="closeModal('addMemoryModal')" class="flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                            Hủy
                        </button>
                        <button type="submit" class="flex-1 btn-gradient">
                            Thêm Kỷ Niệm
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentDate = new Date();
        let memories = JSON.parse(localStorage.getItem('memories')) || [];
        let photos = JSON.parse(localStorage.getItem('photos')) || [];
        
        // Biến cấu hình toàn cục
        let CONFIG = {};
        let GITHUB_USERNAME, REPO_NAME, PAT, FILE_PATH, COMMENTS_FILE_PATH, PHOTOS_METADATA_FILE_PATH, LOGS_FILE_PATH;
        let API_BASE_URL, COMMENTS_API_URL, PHOTOS_METADATA_API_URL, LOGS_API_URL;
        let FOLDER_ID, API_KEY, PHOTOS_PER_PAGE;
        let CONFIG_API_URL;
        
        // Hàm hiển thị thông báo
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm animate-fade-in`;
            
            switch(type) {
                case 'error':
                    messageDiv.className += ' bg-red-500 text-white';
                    break;
                case 'warning':
                    messageDiv.className += ' bg-yellow-500 text-black';
                    break;
                case 'success':
                    messageDiv.className += ' bg-green-500 text-white';
                    break;
                default:
                    messageDiv.className += ' bg-blue-500 text-white';
            }
            
            messageDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-lg">&times;</button>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            // Tự động ẩn sau 5 giây
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.remove();
                }
            }, 5000);
        }
        
        async function loadConfig() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                const response = await fetch('./configApp.json', {
                    signal: controller.signal,
                    cache: 'no-cache'
                });
                clearTimeout(timeoutId);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                CONFIG = await response.json();
                const requiredFields = ['GITHUB_USERNAME', 'REPO_NAME', 'PAT1', 'PAT2'];
                const missingFields = requiredFields.filter(field => {
                    const value = CONFIG[field];
                    return !value || value.toString().trim() === '';
                });
                if (missingFields.length > 0) {
                    throw new Error(`Thiếu cấu hình: ${missingFields.join(', ')}`);
                }
            } catch (error) {
                // Sử dụng cấu hình demo khi không tải được file
                console.warn('Không thể tải file cấu hình, sử dụng cấu hình demo:', error.message);
                showMessage('⚠️ Sử dụng cấu hình demo do không tải được file cấu hình', 'warning');
                
                CONFIG = {
                    "GITHUB_USERNAME": "nhungcute",
                    "REPO_NAME": "LoveStory",
                    "PAT1": "ghp_a8VLpoCYQByLbUIwe",
                    "PAT2": "d3dy4hHjEpKwr3stE6T",
                    "FILE_PATH": "actions.json",
                    "COMMENTS_FILE_PATH": "comments.json",
                    "PHOTOS_METADATA_FILE_PATH": "image_data.json",
                    "LOGS_FILE_PATH": "logs.json",
                    "FOLDER_ID": "1B_tpWbLwlc7mqT789-g2RO9K2pYNXVav",
                    "API_KEY": "AIzaSyDJddlVwOWA8vzdVNrcp70if4eOL30xjp0",
                    "PHOTOS_PER_PAGE": 50,
                    "AUTO_LOAD_METADATA": "true"
                };
            }
            
            // Thiết lập các biến từ CONFIG
            GITHUB_USERNAME = CONFIG.GITHUB_USERNAME;
            REPO_NAME = CONFIG.REPO_NAME;
            PAT = CONFIG.PAT1 + CONFIG.PAT2;
            FILE_PATH = CONFIG.FILE_PATH;
            COMMENTS_FILE_PATH = CONFIG.COMMENTS_FILE_PATH;
            PHOTOS_METADATA_FILE_PATH = CONFIG.PHOTOS_METADATA_FILE_PATH;
            LOGS_FILE_PATH = CONFIG.LOGS_FILE_PATH;
            
            // Thiết lập các URL API
            API_BASE_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;
            COMMENTS_API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${COMMENTS_FILE_PATH}`;
            PHOTOS_METADATA_API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${PHOTOS_METADATA_FILE_PATH}`;
            LOGS_API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${LOGS_FILE_PATH}`;
            CONFIG_API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/configApp.json`;
            
            // Cấu hình Google Drive API
            FOLDER_ID = CONFIG.FOLDER_ID;
            API_KEY = CONFIG.API_KEY;
            PHOTOS_PER_PAGE = CONFIG.PHOTOS_PER_PAGE;
            
            return true;
        }
        
        // Sample data if empty
        if (memories.length === 0) {
            memories = [
                {
                    id: 1,
                    title: "Ngày đầu gặp nhau",
                    date: "2023-02-14",
                    description: "Ngày đầu tiên chúng ta gặp nhau tại quán cà phê",
                    type: "special"
                },
                {
                    id: 2,
                    title: "Chuyến đi Đà Lạt",
                    date: "2023-05-20",
                    description: "Chuyến du lịch đầu tiên cùng nhau",
                    type: "travel"
                }
            ];
            localStorage.setItem('memories', JSON.stringify(memories));
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await loadConfig();
                showMessage('✅ Ứng dụng đã khởi tạo thành công!', 'success');
            } catch (error) {
                console.error('Lỗi khởi tạo:', error);
                showMessage('❌ Có lỗi khi khởi tạo ứng dụng', 'error');
            }
            
            updateStats();
            renderCalendar();
            renderMemories();
            renderGallery();
            renderTimeline();
            initCharts();
        });

        // Navigation functions
        function showSection(sectionName) {
            // Hide all sections
            const sections = ['dashboard', 'calendar', 'memories', 'gallery', 'timeline', 'analytics'];
            sections.forEach(section => {
                document.getElementById(section + 'Section').style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').style.display = 'block';
            
            // Update active sidebar item
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.sidebar-item').classList.add('active');
            
            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                calendar: 'Lịch Sự Kiện',
                memories: 'Quản Lý Kỷ Niệm',
                gallery: 'Thư Viện Ảnh',
                timeline: 'Timeline',
                analytics: 'Thống Kê'
            };
            document.getElementById('pageTitle').textContent = titles[sectionName];
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        }



        function toggleNotifications() {
            const dropdown = document.getElementById('notificationsDropdown');
            const settingsDropdown = document.getElementById('settingsDropdown');
            const userDropdown = document.getElementById('userMenuDropdown');
            const mobileSearchDropdown = document.getElementById('mobileSearchDropdown');
            
            // Close other dropdowns
            settingsDropdown.classList.add('hidden');
            userDropdown.classList.add('hidden');
            mobileSearchDropdown.classList.add('hidden');
            
            dropdown.classList.toggle('hidden');
        }

        function toggleSettings() {
            const dropdown = document.getElementById('settingsDropdown');
            const notificationsDropdown = document.getElementById('notificationsDropdown');
            const userDropdown = document.getElementById('userMenuDropdown');
            const mobileSearchDropdown = document.getElementById('mobileSearchDropdown');
            
            // Close other dropdowns
            notificationsDropdown.classList.add('hidden');
            userDropdown.classList.add('hidden');
            mobileSearchDropdown.classList.add('hidden');
            
            dropdown.classList.toggle('hidden');
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userMenuDropdown');
            const notificationsDropdown = document.getElementById('notificationsDropdown');
            const settingsDropdown = document.getElementById('settingsDropdown');
            const mobileSearchDropdown = document.getElementById('mobileSearchDropdown');
            
            // Close other dropdowns
            notificationsDropdown.classList.add('hidden');
            settingsDropdown.classList.add('hidden');
            mobileSearchDropdown.classList.add('hidden');
            
            dropdown.classList.toggle('hidden');
        }

        function toggleMobileSearch() {
            const dropdown = document.getElementById('mobileSearchDropdown');
            const notificationsDropdown = document.getElementById('notificationsDropdown');
            const settingsDropdown = document.getElementById('settingsDropdown');
            const userDropdown = document.getElementById('userMenuDropdown');
            
            // Close other dropdowns
            notificationsDropdown.classList.add('hidden');
            settingsDropdown.classList.add('hidden');
            userDropdown.classList.add('hidden');
            
            dropdown.classList.toggle('hidden');
            
            // Focus on search input when opened
            if (!dropdown.classList.contains('hidden')) {
                setTimeout(() => {
                    document.getElementById('mobileSearchInput').focus();
                }, 100);
            }
        }

        // Modal functions
        function showAddModal() {
            document.getElementById('addMemoryModal').classList.remove('hidden');
        }

        function showAddMemoryModal() {
            document.getElementById('addMemoryModal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Memory management
        function addMemory(event) {
            event.preventDefault();
            
            const memory = {
                id: Date.now(),
                title: document.getElementById('memoryTitle').value,
                date: document.getElementById('memoryDate').value,
                description: document.getElementById('memoryDescription').value,
                type: document.getElementById('memoryType').value
            };
            
            memories.push(memory);
            localStorage.setItem('memories', JSON.stringify(memories));
            
            renderMemories();
            renderTimeline();
            updateStats();
            closeModal('addMemoryModal');
            
            // Reset form
            document.getElementById('memoryForm').reset();
        }

        function deleteMemory(id) {
            if (confirm('Bạn có chắc chắn muốn xóa kỷ niệm này?')) {
                memories = memories.filter(memory => memory.id !== id);
                localStorage.setItem('memories', JSON.stringify(memories));
                renderMemories();
                renderTimeline();
                updateStats();
            }
        }

        function editMemory(id) {
            const memory = memories.find(m => m.id === id);
            if (memory) {
                document.getElementById('memoryTitle').value = memory.title;
                document.getElementById('memoryDate').value = memory.date;
                document.getElementById('memoryDescription').value = memory.description;
                document.getElementById('memoryType').value = memory.type;
                
                // Remove old memory and show modal
                deleteMemory(id);
                showAddMemoryModal();
            }
        }

        // Render functions
        function renderMemories() {
            const memoriesList = document.getElementById('memoriesList');
            memoriesList.innerHTML = '';
            
            memories.forEach(memory => {
                const memoryCard = document.createElement('div');
                memoryCard.className = 'widget-card p-4 animate-fade-in';
                memoryCard.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-semibold text-lg">${memory.title}</h4>
                        <div class="flex space-x-2">
                            <button onclick="editMemory(${memory.id})" class="text-blue-400 hover:text-blue-300">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteMemory(${memory.id})" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-300 text-sm mb-2">${formatDate(memory.date)}</p>
                    <p class="text-gray-400 text-sm mb-3">${memory.description}</p>
                    <span class="inline-block px-3 py-1 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full text-xs">
                        ${getTypeLabel(memory.type)}
                    </span>
                `;
                memoriesList.appendChild(memoryCard);
            });
        }

        // Photo gallery variables
        let currentPage = 1;
        let totalPhotos = 0;
        let photosData = [];
        let isLoadingPhotos = false;

        async function loadPhotosMetadata() {
            try {
                if (!GITHUB_USERNAME || !REPO_NAME || !PAT) {
                    throw new Error('Chưa có cấu hình GitHub');
                }

                const response = await fetch(PHOTOS_METADATA_API_URL, {
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const content = atob(data.content);
                    photosData = JSON.parse(content);
                    totalPhotos = photosData.length;
                    return photosData;
                } else if (response.status === 404) {
                    // File không tồn tại, tạo dữ liệu mẫu
                    photosData = generateSamplePhotosData();
                    totalPhotos = photosData.length;
                    await savePhotosMetadata(photosData);
                    return photosData;
                } else {
                    throw new Error(`Lỗi tải metadata: ${response.status}`);
                }
            } catch (error) {
                console.error('Lỗi tải photos metadata:', error);
                // Sử dụng dữ liệu mẫu
                photosData = generateSamplePhotosData();
                totalPhotos = photosData.length;
                showMessage('⚠️ Sử dụng dữ liệu ảnh mẫu', 'warning');
                return photosData;
            }
        }

        function generateSamplePhotosData() {
            const samplePhotos = [];
            for (let i = 1; i <= 50; i++) {
                samplePhotos.push({
                    id: `sample_${i}`,
                    name: `Ảnh kỷ niệm ${i}`,
                    url: `https://picsum.photos/400/400?random=${i}`,
                    thumbnail: `https://picsum.photos/200/200?random=${i}`,
                    date: new Date(2023, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toISOString().split('T')[0],
                    description: `Mô tả cho ảnh kỷ niệm số ${i}`,
                    tags: ['kỷ niệm', 'yêu thương', Math.random() > 0.5 ? 'du lịch' : 'hẹn hò'],
                    likes: Math.floor(Math.random() * 100),
                    comments: Math.floor(Math.random() * 20)
                });
            }
            return samplePhotos;
        }

        async function savePhotosMetadata(data) {
            try {
                if (!GITHUB_USERNAME || !REPO_NAME || !PAT) return;

                const content = btoa(JSON.stringify(data, null, 2));
                
                // Kiểm tra file có tồn tại không
                let sha = null;
                try {
                    const existingResponse = await fetch(PHOTOS_METADATA_API_URL, {
                        headers: {
                            'Authorization': `token ${PAT}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (existingResponse.ok) {
                        const existingData = await existingResponse.json();
                        sha = existingData.sha;
                    }
                } catch (e) {}

                const payload = {
                    message: `Cập nhật metadata ảnh - ${new Date().toLocaleString('vi-VN')}`,
                    content: content
                };

                if (sha) {
                    payload.sha = sha;
                }

                await fetch(PHOTOS_METADATA_API_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
            } catch (error) {
                console.error('Lỗi lưu photos metadata:', error);
            }
        }

        async function renderGallery() {
            if (isLoadingPhotos) return;
            
            const gallery = document.getElementById('photoGallery');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'col-span-full text-center py-8';
            loadingDiv.innerHTML = '<i class="fas fa-spinner fa-spin text-2xl text-blue-400"></i><p class="mt-2">Đang tải ảnh...</p>';
            gallery.appendChild(loadingDiv);

            try {
                isLoadingPhotos = true;
                
                if (photosData.length === 0) {
                    await loadPhotosMetadata();
                }

                // Clear gallery
                gallery.innerHTML = '';

                // Calculate pagination
                const photosPerPage = PHOTOS_PER_PAGE || 12;
                const startIndex = (currentPage - 1) * photosPerPage;
                const endIndex = startIndex + photosPerPage;
                const currentPhotos = photosData.slice(startIndex, endIndex);

                if (currentPhotos.length === 0) {
                    gallery.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fas fa-images text-6xl text-gray-400 mb-4"></i>
                            <p class="text-gray-400 text-lg">Chưa có ảnh nào</p>
                            <button class="btn-gradient mt-4" onclick="showAddPhotoModal()">
                                <i class="fas fa-plus mr-2"></i>Thêm ảnh đầu tiên
                            </button>
                        </div>
                    `;
                    return;
                }

                // Render photos
                currentPhotos.forEach((photo, index) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item cursor-pointer relative group';
                    photoItem.innerHTML = `
                        <div class="relative overflow-hidden rounded-lg">
                            <img src="${photo.thumbnail || photo.url}" 
                                 alt="${photo.name}" 
                                 class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-110"
                                 onerror="this.src='https://via.placeholder.com/200x200/667eea/ffffff?text=Ảnh+lỗi'">
                            
                            <!-- Overlay -->
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-300 flex items-center justify-center">
                                <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-center">
                                    <button onclick="openPhotoModal('${photo.id}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-3 mx-1">
                                        <i class="fas fa-eye text-white"></i>
                                    </button>
                                    <button onclick="likePhoto('${photo.id}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-3 mx-1">
                                        <i class="fas fa-heart text-white"></i>
                                    </button>
                                    <button onclick="sharePhoto('${photo.id}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-3 mx-1">
                                        <i class="fas fa-share text-white"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Photo info -->
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-3">
                                <p class="text-white text-sm font-medium truncate">${photo.name}</p>
                                <div class="flex items-center justify-between text-xs text-gray-300 mt-1">
                                    <span>${formatDate(photo.date)}</span>
                                    <div class="flex items-center space-x-2">
                                        <span><i class="fas fa-heart text-red-400"></i> ${photo.likes || 0}</span>
                                        <span><i class="fas fa-comment text-blue-400"></i> ${photo.comments || 0}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    gallery.appendChild(photoItem);
                });

                // Render pagination
                renderPhotoPagination();

            } catch (error) {
                console.error('Lỗi render gallery:', error);
                gallery.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-exclamation-triangle text-6xl text-red-400 mb-4"></i>
                        <p class="text-red-400 text-lg">Lỗi tải ảnh</p>
                        <button class="btn-gradient mt-4" onclick="renderGallery()">
                            <i class="fas fa-refresh mr-2"></i>Thử lại
                        </button>
                    </div>
                `;
            } finally {
                isLoadingPhotos = false;
            }
        }

        function renderPhotoPagination() {
            const photosPerPage = PHOTOS_PER_PAGE || 12;
            const totalPages = Math.ceil(totalPhotos / photosPerPage);
            
            if (totalPages <= 1) return;

            const gallery = document.getElementById('photoGallery');
            const paginationDiv = document.createElement('div');
            paginationDiv.className = 'col-span-full flex justify-center items-center space-x-2 mt-6';

            let paginationHTML = '';

            // Previous button
            if (currentPage > 1) {
                paginationHTML += `
                    <button onclick="changePhotoPage(${currentPage - 1})" class="px-3 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;
            }

            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                paginationHTML += `<button onclick="changePhotoPage(1)" class="px-3 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="px-2 text-gray-400">...</span>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentPage;
                paginationHTML += `
                    <button onclick="changePhotoPage(${i})" class="px-3 py-2 ${isActive ? 'bg-gradient-to-r from-pink-500 to-purple-600' : 'bg-white bg-opacity-10 hover:bg-opacity-20'} rounded-lg transition-all">
                        ${i}
                    </button>
                `;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="px-2 text-gray-400">...</span>`;
                }
                paginationHTML += `<button onclick="changePhotoPage(${totalPages})" class="px-3 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all">${totalPages}</button>`;
            }

            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `
                    <button onclick="changePhotoPage(${currentPage + 1})" class="px-3 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }

            paginationDiv.innerHTML = paginationHTML;
            gallery.appendChild(paginationDiv);

            // Add page info
            const pageInfoDiv = document.createElement('div');
            pageInfoDiv.className = 'col-span-full text-center text-gray-400 text-sm mt-4';
            pageInfoDiv.innerHTML = `Trang ${currentPage} / ${totalPages} - Tổng ${totalPhotos} ảnh`;
            gallery.appendChild(pageInfoDiv);
        }

        function changePhotoPage(page) {
            currentPage = page;
            renderGallery();
            
            // Scroll to gallery top
            document.getElementById('gallerySection').scrollIntoView({ behavior: 'smooth' });
        }

        function likePhoto(photoId) {
            const photo = photosData.find(p => p.id === photoId);
            if (photo) {
                photo.likes = (photo.likes || 0) + 1;
                savePhotosMetadata(photosData);
                renderGallery();
                showMessage('❤️ Đã thích ảnh!', 'success');
            }
        }

        function sharePhoto(photoId) {
            const photo = photosData.find(p => p.id === photoId);
            if (photo && navigator.share) {
                navigator.share({
                    title: photo.name,
                    text: photo.description,
                    url: photo.url
                });
            } else {
                // Fallback: copy to clipboard
                if (photo) {
                    navigator.clipboard.writeText(photo.url).then(() => {
                        showMessage('📋 Đã copy link ảnh!', 'success');
                    });
                }
            }
        }

        function renderTimeline() {
            const timeline = document.getElementById('timelineList');
            timeline.innerHTML = '';
            
            const sortedMemories = [...memories].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedMemories.forEach(memory => {
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item animate-slide-in';
                timelineItem.innerHTML = `
                    <div class="widget-card p-4 ml-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold text-lg">${memory.title}</h4>
                                <p class="text-gray-300 text-sm">${formatDate(memory.date)}</p>
                                <p class="text-gray-400 mt-2">${memory.description}</p>
                            </div>
                            <span class="inline-block px-3 py-1 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full text-xs">
                                ${getTypeLabel(memory.type)}
                            </span>
                        </div>
                    </div>
                `;
                timeline.appendChild(timelineItem);
            });
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update month display
            const monthNames = ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
                              'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Get first day and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Clear calendar
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Add empty cells
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                calendarDays.appendChild(emptyDay);
            }
            
            // Add days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day text-center py-3 cursor-pointer';
                dayElement.textContent = day;
                
                // Check for events
                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const hasEvent = memories.some(memory => memory.date === dateString);
                
                if (hasEvent) {
                    dayElement.classList.add('has-event');
                }
                
                calendarDays.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        // Utility functions
        function updateStats() {
            document.getElementById('totalEvents').textContent = memories.length;
            document.getElementById('totalPhotos').textContent = Math.floor(Math.random() * 200) + 100;
            
            // Calculate days together (from first memory)
            if (memories.length > 0) {
                const firstDate = new Date(Math.min(...memories.map(m => new Date(m.date))));
                const today = new Date();
                const daysTogether = Math.floor((today - firstDate) / (1000 * 60 * 60 * 24));
                document.getElementById('daysTogether').textContent = daysTogether;
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN');
        }

        function getTypeLabel(type) {
            const labels = {
                anniversary: 'Kỷ niệm',
                date: 'Hẹn hò',
                travel: 'Du lịch',
                special: 'Đặc biệt'
            };
            return labels[type] || type;
        }

        function openPhotoModal(photoId) {
            const photo = photosData.find(p => p.id === photoId);
            if (!photo) return;

            // Create modal
            const modal = document.createElement('div');
            modal.id = 'photoModal';
            modal.className = 'fixed inset-0 modal-dark z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="modal-content-dark max-w-4xl w-full max-h-full overflow-auto">
                    <div class="flex justify-between items-center p-4 border-b border-gray-600">
                        <h3 class="text-xl font-bold">${photo.name}</h3>
                        <button onclick="closePhotoModal()" class="text-gray-400 hover:text-white text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="p-4">
                        <div class="text-center mb-4">
                            <img src="${photo.url}" alt="${photo.name}" class="max-w-full max-h-96 mx-auto rounded-lg shadow-lg"
                                 onerror="this.src='https://via.placeholder.com/400x400/667eea/ffffff?text=Ảnh+lỗi'">
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold mb-2">Thông tin ảnh</h4>
                                <div class="space-y-2 text-sm">
                                    <p><span class="text-gray-400">Ngày:</span> ${formatDate(photo.date)}</p>
                                    <p><span class="text-gray-400">Mô tả:</span> ${photo.description || 'Không có mô tả'}</p>
                                    <p><span class="text-gray-400">Tags:</span> 
                                        ${photo.tags ? photo.tags.map(tag => `<span class="inline-block bg-blue-500 bg-opacity-20 px-2 py-1 rounded-full text-xs mr-1">${tag}</span>`).join('') : 'Không có tag'}
                                    </p>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">Tương tác</h4>
                                <div class="flex items-center space-x-4 mb-4">
                                    <button onclick="likePhoto('${photo.id}')" class="flex items-center space-x-2 bg-red-500 bg-opacity-20 hover:bg-opacity-30 px-3 py-2 rounded-lg transition-all">
                                        <i class="fas fa-heart text-red-400"></i>
                                        <span>${photo.likes || 0}</span>
                                    </button>
                                    <button onclick="sharePhoto('${photo.id}')" class="flex items-center space-x-2 bg-blue-500 bg-opacity-20 hover:bg-opacity-30 px-3 py-2 rounded-lg transition-all">
                                        <i class="fas fa-share text-blue-400"></i>
                                        <span>Chia sẻ</span>
                                    </button>
                                    <button onclick="downloadPhoto('${photo.id}')" class="flex items-center space-x-2 bg-green-500 bg-opacity-20 hover:bg-opacity-30 px-3 py-2 rounded-lg transition-all">
                                        <i class="fas fa-download text-green-400"></i>
                                        <span>Tải về</span>
                                    </button>
                                </div>
                                
                                <div class="text-sm text-gray-400">
                                    <p><i class="fas fa-comment mr-2"></i>${photo.comments || 0} bình luận</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center p-4 border-t border-gray-600">
                        <div class="flex space-x-2">
                            <button onclick="previousPhoto('${photo.id}')" class="px-4 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all">
                                <i class="fas fa-chevron-left mr-2"></i>Trước
                            </button>
                            <button onclick="nextPhoto('${photo.id}')" class="px-4 py-2 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg transition-all">
                                Sau<i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                        <button onclick="closePhotoModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-all">
                            Đóng
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            
            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closePhotoModal();
                }
            });
        }

        function closePhotoModal() {
            const modal = document.getElementById('photoModal');
            if (modal) {
                modal.remove();
            }
        }

        function previousPhoto(currentPhotoId) {
            const currentIndex = photosData.findIndex(p => p.id === currentPhotoId);
            if (currentIndex > 0) {
                closePhotoModal();
                openPhotoModal(photosData[currentIndex - 1].id);
            }
        }

        function nextPhoto(currentPhotoId) {
            const currentIndex = photosData.findIndex(p => p.id === currentPhotoId);
            if (currentIndex < photosData.length - 1) {
                closePhotoModal();
                openPhotoModal(photosData[currentIndex + 1].id);
            }
        }

        function downloadPhoto(photoId) {
            const photo = photosData.find(p => p.id === photoId);
            if (photo) {
                const link = document.createElement('a');
                link.href = photo.url;
                link.download = photo.name || 'photo.jpg';
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showMessage('📥 Đang tải ảnh...', 'info');
            }
        }

        function showAddPhotoModal() {
            showMessage('📸 Tính năng tải ảnh lên sẽ được phát triển!', 'info');
        }

        function initCharts() {
            // Activity Chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
                    datasets: [{
                        label: 'Hoạt động',
                        data: [12, 19, 3, 5, 2, 3, 9],
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });

            // Event Chart
            const eventCtx = document.getElementById('eventChart').getContext('2d');
            new Chart(eventCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Kỷ niệm', 'Hẹn hò', 'Du lịch', 'Đặc biệt'],
                    datasets: [{
                        data: [30, 25, 20, 25],
                        backgroundColor: [
                            'rgb(102, 126, 234)',
                            'rgb(240, 147, 251)',
                            'rgb(79, 172, 254)',
                            'rgb(245, 87, 108)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });

            // Happiness Chart
            const happinessCtx = document.getElementById('happinessChart').getContext('2d');
            new Chart(happinessCtx, {
                type: 'bar',
                data: {
                    labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
                    datasets: [{
                        label: 'Mức độ hạnh phúc (%)',
                        data: [85, 90, 78, 92, 88, 95, 87, 91, 89, 93, 86, 94],
                        backgroundColor: 'rgba(240, 147, 251, 0.8)',
                        borderColor: 'rgb(240, 147, 251)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Form submission
        document.getElementById('memoryForm').addEventListener('submit', addMemory);

        // Responsive sidebar
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 768) {
                document.getElementById('sidebar').classList.remove('mobile-open');
            }
        });

        // Close dropdowns and sidebar when clicking outside
        document.addEventListener('click', function(event) {
            const notificationsDropdown = document.getElementById('notificationsDropdown');
            const settingsDropdown = document.getElementById('settingsDropdown');
            const userDropdown = document.getElementById('userMenuDropdown');
            const mobileSearchDropdown = document.getElementById('mobileSearchDropdown');
            const sidebar = document.getElementById('sidebar');
            
            // Check if click is outside dropdowns and their trigger buttons
            if (!event.target.closest('#notificationsDropdown') && 
                !event.target.closest('button[onclick="toggleNotifications()"]')) {
                notificationsDropdown.classList.add('hidden');
            }
            
            if (!event.target.closest('#settingsDropdown') && 
                !event.target.closest('button[onclick="toggleSettings()"]')) {
                settingsDropdown.classList.add('hidden');
            }
            
            if (!event.target.closest('#userMenuDropdown') && 
                !event.target.closest('div[onclick="toggleUserMenu()"]')) {
                userDropdown.classList.add('hidden');
            }
            
            if (!event.target.closest('#mobileSearchDropdown') && 
                !event.target.closest('button[onclick="toggleMobileSearch()"]')) {
                mobileSearchDropdown.classList.add('hidden');
            }
            
            // Close sidebar on mobile when clicking outside
            if (window.innerWidth < 768 && 
                !event.target.closest('#sidebar') && 
                !event.target.closest('button[onclick="toggleSidebar()"]')) {
                sidebar.classList.remove('mobile-open');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98834b253005096a',t:'MTc1OTM5ODYwNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
