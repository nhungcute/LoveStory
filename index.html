<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Đáng Yêu 💕 - Phiên bản 44</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #FFF5F7 0%, #FFE8ED 50%, #FFF0F5 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 182, 193, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 105, 180, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 192, 203, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        .calendar-container {
            background: linear-gradient(145deg, #ffffff 0%, #fef7ff 100%);
            border-radius: 20px;
            box-shadow: 
                0 20px 40px rgba(252, 189, 210, 0.3),
                0 0 0 1px rgba(255, 182, 193, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            overflow: hidden;
            width: 90vw;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .calendar-container::before {
            content: '';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 20px;
            animation: sparkle 2s ease-in-out infinite;
            z-index: 10;
        }
        
        .calendar-container::after {
            content: '💖';
            position: absolute;
            bottom: 15px;
            left: 20px;
            font-size: 18px;
            animation: heartbeat 1.5s ease-in-out infinite;
            z-index: 10;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.7; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .calendar-header {
            background: linear-gradient(135deg, #FF85A2 0%, #FF6B9D 50%, #E91E63 100%);
            border-radius: 20px 20px 0 0;
            position: relative;
            overflow: hidden;
        }
        
        .calendar-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .calendar-header::after {
            content: '🌸 💕 🌸';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            opacity: 0.3;
            white-space: nowrap;
            pointer-events: none;
        }
        
        .day-name {
            color: #FF85A2;
            font-weight: 600;
        }
        
        .day-name.weekend {
            color: #FF5252;
        }
        
        .date-cell {
            border-radius: 50%;
            width: clamp(28px, 4vw, 45px);
            height: clamp(28px, 4vw, 45px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            margin: auto;
            font-size: clamp(11px, 1.8vw, 18px);
        }
        
        .date-cell:hover {
            background-color: #FFE0E8;
            transform: scale(1.1);
        }
        
        .date-cell.today {
            background-color: #FF85A2;
            color: white;
            font-weight: bold;
        }
        
        .date-cell.active {
            background-color: #FFE0E8;
            color: #FF85A2;
            font-weight: bold;
        }
        
        .date-cell.selected {
            box-shadow: 0 0 0 2px #FF5252;
            z-index: 10;
            font-weight: bold;
        }
        
        .date-cell.today.active {
            background-color: #FF85A2;
            color: white;
        }
        
        .date-cell.other-month {
            opacity: 0.4;
            color: #999;
        }
        
        .date-cell.weekend {
            color: #FF5252;
        }
        
        .date-cell.weekend.other-month {
            color: #FF5252;
            opacity: 0.4;
        }
        
        .date-cell.has-event::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            background-color: #FF85A2;
            border-radius: 50%;
        }
        
        .date-cell.weekend.has-event::after {
            background-color: #FF5252;
        }
        
        .date-cell.today.has-event::after,
        .date-cell.active.has-event::after {
            background-color: white;
        }
        
        .date-cell.anniversary {
            position: relative;
            z-index: 1;
        }
        
        .date-cell.anniversary::before {
            content: '❤️';
            position: absolute;
            font-size: 10px;
            top: -2px;
            right: 0px;
            z-index: 1;
        }
        
        .date-cell.anniversary::after {
            content: '❤️';
            position: absolute;
            font-size: 10px;
            bottom: -2px;
            left: 0px;
            z-index: 1;
        }
        
        .month-nav {
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .month-nav:hover {
            transform: scale(1.2);
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .today-info {
            background: linear-gradient(145deg, #ffffff 0%, #fef7ff 100%);
            border: 2px solid #FFE0E8;
            border-radius: 20px;
            box-shadow: 
                0 8px 25px rgba(252, 189, 210, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .today-info::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 182, 193, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            pointer-events: none;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .today-info > * {
            position: relative;
            z-index: 1;
        }
        

    </style>
</head>
<body class="min-h-screen">
    <!-- Floating Decorations -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="absolute top-10 left-10 text-2xl animate-bounce" style="animation-delay: 0s;">🌸</div>
        <div class="absolute top-20 right-16 text-xl animate-pulse" style="animation-delay: 1s;">💖</div>
        <div class="absolute top-1/3 left-20 text-lg animate-bounce" style="animation-delay: 2s;">✨</div>
        <div class="absolute top-1/2 right-10 text-2xl animate-pulse" style="animation-delay: 0.5s;">🌺</div>
        <div class="absolute bottom-1/3 left-16 text-xl animate-bounce" style="animation-delay: 1.5s;">💕</div>
        <div class="absolute bottom-20 right-20 text-lg animate-pulse" style="animation-delay: 2.5s;">🦋</div>
        <div class="absolute bottom-10 left-1/4 text-2xl animate-bounce" style="animation-delay: 3s;">🌷</div>
        <div class="absolute top-1/4 right-1/3 text-lg animate-pulse" style="animation-delay: 0.8s;">💫</div>
    </div>



    <div class="w-full mx-auto relative z-10">
        <!-- Header -->
        <div class="text-center mb-8 px-4">
            <!-- Header removed -->
        </div>

        <!-- Calendar Container -->
        <div class="calendar-container mx-auto">
            <!-- Calendar Header -->
            <div class="calendar-header p-4 md:p-6">
                <div class="flex items-center justify-between">
                    <button id="prevMonth" class="month-nav">
                        <svg class="w-5 h-5" fill="white" stroke="white" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    
                    <div class="text-center">
                        <h2 id="monthYear" class="text-xl md:text-2xl font-bold text-white"></h2>
                    </div>
                    
                    <button id="nextMonth" class="month-nav">
                        <svg class="w-5 h-5" fill="white" stroke="white" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Days of Week -->
            <div class="grid grid-cols-7 bg-gray-50 border-b">
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">CN</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">T2</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">T3</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">T4</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name text-sm md:text-base">T5</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name weekend text-sm md:text-base">T6</div>
                <div class="p-2 md:p-3 text-center font-semibold day-name weekend text-sm md:text-base">T7</div>
            </div>

            <!-- Calendar Days -->
            <div id="calendarDays" class="grid grid-cols-7 p-2">
                <!-- Days will be generated by JavaScript -->
            </div>
        </div>

        <!-- Today's Info and Anniversary Info -->
        <div class="mt-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 w-[90%] mx-auto">
                <div class="today-info px-6 py-4 min-h-[120px] flex flex-col justify-center text-center">
                    <p class="text-gray-600 text-sm">Hôm nay</p>
                    <p id="todayDate" class="text-lg font-bold text-gray-800"></p>
                </div>
                <div id="anniversaryInfo" class="today-info px-6 py-4 bg-gradient-to-r from-pink-50 to-red-50 border-pink-300 min-h-[120px] flex flex-col justify-center text-center">
                    <p id="anniversaryLabel" class="text-pink-600 text-sm">Kỉ niệm sắp tới</p>
                    <p id="anniversaryDate" class="text-lg font-bold text-pink-800"></p>
                    <p id="daysLeft" class="text-sm text-pink-600 mt-1"></p>
                    <p id="anniversaryYears" class="text-xs text-pink-500"></p>
                </div>
            </div>
        </div>

        <!-- Events List -->
        <div class="mt-8 flex justify-center">
            <div class="calendar-container mx-auto">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">📅 Sự kiện</h3>
                        <div class="flex space-x-2">
                            <button id="addEventBtn" class="p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors" data-bs-toggle="modal" data-bs-target="#addEventModal">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                            <button id="deleteEventBtn" class="p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors" disabled>
                                <i class="bi bi-trash"></i>
                            </button>
                            <button id="refreshEvents" class="p-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Loading Spinner -->
                    <div id="loading-spinner" class="hidden flex justify-center items-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"></div>
                        <span class="ml-2 text-gray-600">Đang tải...</span>
                    </div>
                    
                    <!-- Events Container -->
                    <div id="eventsContainer" class="space-y-3">
                        <!-- Events will be loaded here -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden text-center py-8 text-gray-500">
                        <p>📝 Chưa có sự kiện nào</p>
                    </div>
                    
                    <!-- Error Message -->
                    <div id="errorMessage" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">
                        <p>❌ Không thể tải danh sách sự kiện</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Newsfeed Section -->
        <div class="mt-8 flex justify-center">
            <div class="calendar-container mx-auto">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">📸 Khoảnh Khắc Đáng Yêu</h3>
                        <button id="refreshPhotos" class="p-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Loading Spinner for Photos -->
                    <div id="photos-loading-spinner" class="hidden flex justify-center items-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"></div>
                        <span class="ml-2 text-gray-600">Đang tải ảnh...</span>
                    </div>
                    
                    <!-- Photos Grid -->
                    <div id="photosGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Photos will be loaded here -->
                    </div>
                    
                    <!-- Empty State for Photos -->
                    <div id="photosEmptyState" class="hidden text-center py-8 text-gray-500">
                        <p>📷 Chưa có ảnh nào</p>
                    </div>
                    
                    <!-- Error Message for Photos -->
                    <div id="photosErrorMessage" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">
                        <p>❌ Không thể tải danh sách ảnh</p>
                    </div>
                </div>
            </div>
        </div>

    </div>



    <!-- Modal Thêm Sự Kiện -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-gradient-to-r from-pink-500 to-purple-600 text-white">
                    <h5 class="modal-title" id="addEventModalLabel">✨ Thêm Mới Sự Kiện</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addEventForm">
                        <!-- Ngày sự kiện -->
                        <div class="mb-3">
                            <label for="eventDate" class="form-label fw-bold">📅 Ngày sự kiện</label>
                            <input type="date" class="form-control" id="eventDate" required>
                            <div class="form-text">Hoặc nhập theo định dạng DD/MM/YYYY</div>
                        </div>

                        <!-- Nội dung -->
                        <div class="mb-3">
                            <label for="eventContent" class="form-label fw-bold">📝 Nội dung</label>
                            <textarea class="form-control" id="eventContent" rows="3" placeholder="Nhập nội dung sự kiện..." required></textarea>
                        </div>

                        <!-- Màu -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">🎨 Màu</label>
                            <div class="d-flex flex-wrap gap-2 mt-2 justify-content-center justify-content-sm-start">
                                <input type="radio" class="btn-check" name="eventColor" id="color-pink" value="bg-pink-500" checked>
                                <label class="btn btn-outline-secondary p-2" for="color-pink">
                                    <div class="w-6 h-6 bg-pink-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-blue" value="bg-blue-500">
                                <label class="btn btn-outline-secondary p-2" for="color-blue">
                                    <div class="w-6 h-6 bg-blue-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-green" value="bg-green-500">
                                <label class="btn btn-outline-secondary p-2" for="color-green">
                                    <div class="w-6 h-6 bg-green-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-yellow" value="bg-yellow-500">
                                <label class="btn btn-outline-secondary p-2" for="color-yellow">
                                    <div class="w-6 h-6 bg-yellow-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-purple" value="bg-purple-500">
                                <label class="btn btn-outline-secondary p-2" for="color-purple">
                                    <div class="w-6 h-6 bg-purple-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>

                                <input type="radio" class="btn-check" name="eventColor" id="color-red" value="bg-red-500">
                                <label class="btn btn-outline-secondary p-2" for="color-red">
                                    <div class="w-6 h-6 bg-red-500 rounded" style="width: 24px; height: 24px;"></div>
                                </label>
                            </div>
                        </div>

                        <!-- Icon -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">🎭 Icon</label>
                            <div class="d-flex flex-wrap gap-2 mt-2 justify-content-center justify-content-sm-start">
                                <input type="radio" class="btn-check" name="eventIcon" id="icon-heart" value="❤️" checked>
                                <label class="btn btn-outline-secondary" for="icon-heart">❤️</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-star" value="⭐">
                                <label class="btn btn-outline-secondary" for="icon-star">⭐</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-cake" value="🎂">
                                <label class="btn btn-outline-secondary" for="icon-cake">🎂</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-gift" value="🎁">
                                <label class="btn btn-outline-secondary" for="icon-gift">🎁</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-party" value="🎉">
                                <label class="btn btn-outline-secondary" for="icon-party">🎉</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-music" value="🎵">
                                <label class="btn btn-outline-secondary" for="icon-music">🎵</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-travel" value="✈️">
                                <label class="btn btn-outline-secondary" for="icon-travel">✈️</label>

                                <input type="radio" class="btn-check" name="eventIcon" id="icon-work" value="💼">
                                <label class="btn btn-outline-secondary" for="icon-work">💼</label>
                            </div>
                        </div>

                        <!-- Folder ảnh -->
                        <div class="mb-3">
                            <label for="eventImageFolder" class="form-label fw-bold">📁 Folder ảnh</label>
                            <input type="text" class="form-control" id="eventImageFolder" placeholder="Nhập đường dẫn folder ảnh...">
                            <div class="form-text">Tùy chọn: Đường dẫn đến thư mục chứa ảnh liên quan</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" id="saveEventBtn">
                        <span class="spinner-border spinner-border-sm d-none" id="saveSpinner" role="status" aria-hidden="true"></span>
                        💾 Lưu Sự Kiện
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Modal -->
    <div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="photoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content bg-transparent border-0">
                <div class="modal-header border-0 position-absolute" style="top: 10px; right: 10px; z-index: 1050;">
                    <button type="button" class="btn-close btn-close-white bg-dark rounded-circle p-2" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0 d-flex align-items-center justify-content-center">
                    <img id="modalImage" src="" alt="Photo" class="img-fluid rounded shadow-lg" style="max-height: 90vh; max-width: 100%;">
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Xác Nhận Xóa -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">
                        <i class="bi bi-trash me-2"></i>
                        Xác Nhận Xóa
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Bạn có chắc chắn muốn xóa sự kiện này không?</p>
                    <div id="eventToDelete" class="bg-light p-3 rounded">
                        <!-- Thông tin sự kiện sẽ được hiển thị ở đây -->
                    </div>
                    <p class="text-muted mt-2 mb-0"><small>⚠️ Hành động này không thể hoàn tác!</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <span class="spinner-border spinner-border-sm d-none" id="deleteSpinner" role="status" aria-hidden="true"></span>
                        <i class="bi bi-trash me-1"></i>
                        Xóa Sự Kiện
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cấu hình API GitHub
        const GITHUB_USERNAME = 'nhungcute';
        const REPO_NAME = 'LoveStory';
        const PAT = 'ghp_a8VLpoCYQByLbUI' + 'wed3dy4hHjEpKwr3stE6T';
        const FILE_PATH = 'notes.json';
        const COMMENTS_FILE_PATH = 'mess.json';
        const API_BASE_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;
        const COMMENTS_API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${COMMENTS_FILE_PATH}`;

        // Cấu hình Google Drive API
        const FOLDER_ID = '1B_tpWbLwlc7mqT789-g2RO9K2pYNXVav';
        const API_KEY = 'AIzaSyDJddlVwOWA8vzdVNrcp70if4eOL30xjp0';
        const DRIVE_API_URL = `https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents+and+mimeType+contains+'image/'&key=${API_KEY}&fields=files(id,name,webViewLink,thumbnailLink,webContentLink)`;

        // Global variables
        let photosData = [];
        let commentsData = {};

        // Hàm tải ảnh từ Google Drive
        async function loadPhotosFromDrive() {
            const loadingSpinner = document.getElementById('photos-loading-spinner');
            const photosGrid = document.getElementById('photosGrid');
            const emptyState = document.getElementById('photosEmptyState');
            const errorMessage = document.getElementById('photosErrorMessage');
            
            try {
                // Hiển thị loading
                loadingSpinner.classList.remove('hidden');
                photosGrid.innerHTML = '';
                emptyState.classList.add('hidden');
                errorMessage.classList.add('hidden');
                
                const response = await fetch(DRIVE_API_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                photosData = data.files || [];
                
                loadingSpinner.classList.add('hidden');
                
                if (photosData.length === 0) {
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                // Tải comments
                const { content: comments } = await readComments();
                commentsData = comments;
                
                // Hiển thị ảnh
                displayPhotos(photosData);
                
            } catch (error) {
                console.error('Lỗi khi tải ảnh từ Google Drive:', error);
                loadingSpinner.classList.add('hidden');
                errorMessage.classList.remove('hidden');
            }
        }

        // Hàm hiển thị ảnh trong grid
        function displayPhotos(photos) {
            const photosGrid = document.getElementById('photosGrid');
            photosGrid.innerHTML = '';
            
            photos.forEach((photo, index) => {
                const photoCard = createPhotoCard(photo, index);
                photosGrid.appendChild(photoCard);
            });
        }

        // Hàm tạo card ảnh
        function createPhotoCard(photo, index) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 transform hover:scale-105';
            
            // Tạo URL ảnh từ Google Drive
            const imageUrl = `https://drive.google.com/thumbnail?id=${photo.id}&sz=w400-h400`;
            const fullImageUrl = `https://drive.google.com/uc?id=${photo.id}`;
            
            // Lấy comments cho ảnh này
            const photoComments = commentsData[photo.id] || [];
            
            card.innerHTML = `
                <div class="relative">
                    <img src="${imageUrl}" alt="${photo.name}" 
                         class="w-full h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity"
                         onclick="openPhotoModal('${fullImageUrl}', '${photo.name}')"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTUwQzE4Ni4xOSAxNTAgMTc1IDE2MS4xOSAxNzUgMTc1QzE3NSAxODguODEgMTg2LjE5IDIwMCAyMDAgMjAwQzIxMy44MSAyMDAgMjI1IDE4OC44MSAyMjUgMTc1QzIyNSAxNjEuMTkgMjEzLjgxIDE1MCAyMDAgMTUwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTI1IDEyNUMxMTguMDk2IDEyNSAxMTIuNSAxMzAuNTk2IDExMi41IDEzNy41VjI2Mi41QzExMi41IDI2OS40MDQgMTE4LjA5NiAyNzUgMTI1IDI3NUgyNzVDMjgxLjkwNCAyNzUgMjg3LjUgMjY5LjQwNCAyODcuNSAyNjIuNVYxMzcuNUMyODcuNSAxMzAuNTk2IDI4MS45MDQgMTI1IDI3NSAxMjVIMTI1WiIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjEwIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo='; this.alt='Không thể tải ảnh';">
                    <div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs">
                        📷 ${index + 1}
                    </div>
                </div>
                
                <div class="p-4">
                    <!-- Comments Section -->
                    <div class="border-t pt-3">
                        <div class="mb-3">
                            <h5 class="text-sm font-medium text-gray-600 mb-2">💬 Bình luận (${photoComments.length})</h5>
                            <div class="max-h-32 overflow-y-auto space-y-2" id="comments-${photo.id}">
                                ${photoComments.map(comment => `
                                    <div class="bg-gray-50 rounded p-2 text-sm">
                                        <p class="text-gray-700">${comment.text}</p>
                                        <span class="text-xs text-gray-500">${new Date(comment.timestamp).toLocaleString('vi-VN')}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Add Comment Form -->
                        <div class="flex space-x-2">
                            <textarea placeholder="Thêm bình luận..." 
                                     class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent resize-none overflow-hidden"
                                     id="comment-input-${photo.id}"
                                     rows="1"
                                     style="min-height: 38px;"
                                     onkeypress="handleCommentKeyPress(event, '${photo.id}')"
                                     oninput="autoResizeTextarea(this)"></textarea>
                            <button onclick="addComment('${photo.id}')" 
                                    class="px-3 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors text-sm flex items-center justify-center"
                                    style="min-height: 38px;">
                                <i class="bi bi-send"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Hàm mở modal ảnh
        function openPhotoModal(imageUrl, imageName) {
            const modal = new bootstrap.Modal(document.getElementById('photoModal'));
            const modalImage = document.getElementById('modalImage');
            
            modalImage.src = imageUrl;
            modalImage.alt = imageName;
            
            modal.show();
        }

        // Hàm xử lý khi nhấn Enter trong ô comment
        function handleCommentKeyPress(event, photoId) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                addComment(photoId);
            }
        }

        // Hàm tự động mở rộng textarea
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.max(38, textarea.scrollHeight) + 'px';
        }

        // Hàm thêm comment
        async function addComment(photoId) {
            const input = document.getElementById(`comment-input-${photoId}`);
            const commentText = input.value.trim();
            
            if (!commentText) {
                return;
            }
            
            try {
                // Tạo comment mới
                const newComment = {
                    text: commentText,
                    timestamp: new Date().toISOString()
                };
                
                // Cập nhật dữ liệu comments
                if (!commentsData[photoId]) {
                    commentsData[photoId] = [];
                }
                commentsData[photoId].push(newComment);
                
                // Lưu vào GitHub
                const { sha } = await readComments();
                await writeComments(commentsData, sha);
                
                // Cập nhật giao diện
                const commentsContainer = document.getElementById(`comments-${photoId}`);
                const commentElement = document.createElement('div');
                commentElement.className = 'bg-gray-50 rounded p-2 text-sm';
                commentElement.innerHTML = `
                    <p class="text-gray-700">${commentText}</p>
                    <span class="text-xs text-gray-500">${new Date().toLocaleString('vi-VN')}</span>
                `;
                commentsContainer.appendChild(commentElement);
                
                // Cuộn xuống comment mới
                commentsContainer.scrollTop = commentsContainer.scrollHeight;
                
                // Xóa nội dung input
                input.value = '';
                
                // Cập nhật số lượng comments
                const photo = photosData.find(p => p.id === photoId);
                if (photo) {
                    const photoCard = input.closest('.bg-white');
                    const commentCount = photoCard.querySelector('h5');
                    commentCount.textContent = `💬 Bình luận (${commentsData[photoId].length})`;
                }
                
                showMessage('Bình luận đã được thêm! 💕', 'success');
                
            } catch (error) {
                console.error('Lỗi khi thêm bình luận:', error);
                showMessage('Lỗi khi thêm bình luận. Vui lòng thử lại.', 'error');
            }
        }

        // Hàm mã hóa Base64
        function base64Encode(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }

        // Hàm giải mã Base64
        function base64Decode(str) {
            return decodeURIComponent(escape(atob(str)));
        }

        // Hàm ghi dữ liệu vào file
        async function writeNotes(notes, sha) {
            const content = JSON.stringify(notes, null, 2);
            const encodedContent = base64Encode(content);

            const body = JSON.stringify({
                message: 'Thêm sự kiện mới',
                content: encodedContent,
                sha: sha
            });

            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: body
                });

                const data = await response.json();
                console.log('Đã ghi sự kiện thành công lên GitHub:', data);
                return data;
            } catch (error) {
                console.error('Lỗi khi ghi sự kiện lên GitHub:', error);
                throw error;
            }
        }

        // Hàm xóa sự kiện
        async function deleteEvent(index) {
            const { content: currentEvents, sha } = await readNotes();
            currentEvents.splice(index, 1); // Xóa phần tử tại vị trí index
            
            await writeNotes(currentEvents, sha);
            displayEvents(currentEvents);
            showMessage('Sự kiện đã được xóa thành công! 🗑️', 'success');
        }

        // Hàm hiển thị thông báo
        function showMessage(message, type = 'success') {
            const alertClass = type === 'error' ? 'alert-danger' : 'alert-success';
            const alertHtml = `
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed" style="top: 20px; right: 20px; z-index: 9999;" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', alertHtml);
            
            // Tự động ẩn sau 3 giây
            setTimeout(() => {
                const alert = document.querySelector('.alert');
                if (alert) {
                    alert.remove();
                }
            }, 3000);
        }

        // Hàm đọc và ghi comments
        async function readComments() {
            try {
                const response = await fetch(COMMENTS_API_URL, {
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        // File chưa tồn tại, tạo file mới
                        return { content: {}, sha: null };
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const content = JSON.parse(base64Decode(data.content));
                return { content, sha: data.sha };
            } catch (error) {
                console.error('Lỗi khi đọc comments từ GitHub:', error);
                return { content: {}, sha: null };
            }
        }

        async function writeComments(comments, sha) {
            const content = JSON.stringify(comments, null, 2);
            const encodedContent = base64Encode(content);

            const body = JSON.stringify({
                message: 'Cập nhật comments',
                content: encodedContent,
                ...(sha && { sha: sha })
            });

            try {
                const response = await fetch(COMMENTS_API_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: body
                });

                const data = await response.json();
                console.log('Đã ghi comments thành công lên GitHub:', data);
                return data;
            } catch (error) {
                console.error('Lỗi khi ghi comments lên GitHub:', error);
                throw error;
            }
        }





        // Biến lưu trữ sự kiện được chọn
        let selectedEventIndex = -1;
        let currentEventsData = [];

        // Hàm tính toán thông tin kỷ niệm
        function calculateAnniversary(dateStr) {
            const now = new Date();
            const [day, month, year] = dateStr.split('/').map(Number);
            const originalDate = new Date(year, month - 1, day);
            const nextAnniversary = new Date(now.getFullYear(), month - 1, day);

            // Nếu ngày kỷ niệm trong năm hiện tại đã qua, tính cho năm sau
            if (nextAnniversary < now) {
                nextAnniversary.setFullYear(now.getFullYear() + 1);
            }

            // Tính số ngày còn lại
            const diffTime = nextAnniversary.getTime() - now.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // Tính số năm kỷ niệm đã trôi qua hoặc sắp tới
            const anniversaryYears = nextAnniversary.getFullYear() - originalDate.getFullYear();

            return {
                date: dateStr,
                daysLeft: diffDays,
                anniversaryYears: anniversaryYears
            };
        }

        // Hàm cập nhật thông tin kỷ niệm
        function updateAnniversaryInfo(events) {
            const anniversaryInfo = document.getElementById('anniversaryInfo');
            const anniversaryLabel = document.getElementById('anniversaryLabel');
            const anniversaryDate = document.getElementById('anniversaryDate');
            const daysLeft = document.getElementById('daysLeft');
            const anniversaryYears = document.getElementById('anniversaryYears');

            if (!events || events.length === 0) {
                anniversaryInfo.style.display = 'none';
                return;
            }

            // Tìm sự kiện gần nhất
            let nearestEvent = null;
            let minDays = Infinity;

            events.forEach(event => {
                if (event.day && event.month && event.year) {
                    const day = String(event.day).padStart(2, '0');
                    const month = String(event.month).padStart(2, '0');
                    const dateStr = `${day}/${month}/${event.year}`;
                    
                    const anniversary = calculateAnniversary(dateStr);
                    
                    if (anniversary.daysLeft < minDays) {
                        minDays = anniversary.daysLeft;
                        nearestEvent = {
                            ...anniversary,
                            content: event.contdetl || 'Sự kiện'
                        };
                    }
                }
            });

            if (nearestEvent) {
                anniversaryInfo.style.display = 'block';
                
                if (nearestEvent.anniversaryYears > 0) {
                    anniversaryLabel.innerHTML = `<span style="color: #dd317f;">Kỉ niệm</span> <strong style="color: #dd317f;">${nearestEvent.anniversaryYears}</strong> <span style="color: #dd317f;">năm</span> <span style="color: red;">${nearestEvent.content}</span>`;
                } else {
                    anniversaryLabel.innerHTML = `<span style="color: red;">Sự kiện:</span> <span style="color: red;">${nearestEvent.content}</span>`;
                }
                
                anniversaryDate.textContent = nearestEvent.date;
                daysLeft.textContent = `Còn ${nearestEvent.daysLeft} ngày`;
                anniversaryYears.textContent = '';
            } else {
                anniversaryInfo.style.display = 'none';
            }
        }

        // Hàm cập nhật thông tin kỷ niệm cho sự kiện được chọn
        function updateAnniversaryInfoForSelectedEvent(event) {
            const anniversaryInfo = document.getElementById('anniversaryInfo');
            const anniversaryLabel = document.getElementById('anniversaryLabel');
            const anniversaryDate = document.getElementById('anniversaryDate');
            const daysLeft = document.getElementById('daysLeft');
            const anniversaryYears = document.getElementById('anniversaryYears');

            if (!event || !event.day || !event.month || !event.year) {
                anniversaryInfo.style.display = 'none';
                return;
            }

            const day = String(event.day).padStart(2, '0');
            const month = String(event.month).padStart(2, '0');
            const dateStr = `${day}/${month}/${event.year}`;
            
            const anniversary = calculateAnniversary(dateStr);
            
            anniversaryInfo.style.display = 'block';
            
            if (anniversary.anniversaryYears > 0) {
                anniversaryLabel.innerHTML = `<span style="color: #dd317f;">Kỉ niệm</span> <strong style="color: #dd317f;">${anniversary.anniversaryYears}</strong> <span style="color: #dd317f;">năm</span> <span style="color: red;">${event.contdetl || 'Sự kiện'}</span>`;
            } else {
                anniversaryLabel.innerHTML = `<span style="color: red;">Sự kiện:</span> <span style="color: red;">${event.contdetl || 'Sự kiện'}</span>`;
            }
            
            anniversaryDate.textContent = anniversary.date;
            daysLeft.textContent = `Còn ${anniversary.daysLeft} ngày`;
            anniversaryYears.textContent = '';
        }

        // Hàm hiển thị danh sách sự kiện
        function displayEvents(events) {
            const eventsContainer = document.getElementById('eventsContainer');
            const emptyState = document.getElementById('emptyState');
            const deleteBtn = document.getElementById('deleteEventBtn');
            
            // Lưu dữ liệu sự kiện hiện tại
            currentEventsData = events;
            
            // Cập nhật sự kiện trên lịch
            if (window.calendarInstance) {
                window.calendarInstance.updateEventsFromData(events);
            }
            
            // Cập nhật thông tin kỷ niệm
            updateAnniversaryInfo(events);
            
            if (!events || events.length === 0) {
                emptyState.classList.remove('hidden');
                deleteBtn.disabled = true;
                return;
            }
            
            // Sắp xếp sự kiện theo ngày tăng dần
            const sortedEvents = [...events].sort((a, b) => {
                const dateA = new Date(a.year, a.month - 1, a.day);
                const dateB = new Date(b.year, b.month - 1, b.day);
                return dateA - dateB;
            });
            
            eventsContainer.innerHTML = '';
            
            sortedEvents.forEach((event, index) => {
                const eventElement = document.createElement('div');
                eventElement.className = 'bg-gradient-to-r from-pink-50 to-purple-50 border border-pink-200 rounded-lg p-3 hover:shadow-md transition-all duration-300 cursor-pointer event-item transform hover:scale-105';
                eventElement.dataset.index = index;
                
                // Định dạng ngày theo yêu cầu: day/month/year
                let formattedDate = 'Không có ngày';
                
                // Sử dụng event.day, event.month, event.year
                if (event.day && event.month && event.year) {
                    const day = String(event.day).padStart(2, '0');
                    const month = String(event.month).padStart(2, '0');
                    formattedDate = `${day}/${month}/${event.year}`;
                }
                
                // Lấy nội dung sự kiện từ event.contdetl
                const eventContent = event.contdetl || 'Không có nội dung';
                
                // Lấy màu và icon từ sự kiện
                const eventColor = event.colorClass || 'bg-pink-500';
                const eventIcon = event.icon || '📅';
                
                eventElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <div class="w-3 h-3 ${eventColor} rounded-full"></div>
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-800 font-medium text-sm">
                                <span class="text-pink-600 font-bold">${formattedDate}:</span> 
                                ${eventContent}
                            </p>
                        </div>
                    </div>
                `;
                
                // Thêm sự kiện click để chọn sự kiện
                eventElement.addEventListener('click', () => {
                    // Bỏ chọn tất cả sự kiện khác
                    document.querySelectorAll('.event-item').forEach(item => {
                        item.classList.remove('border-red-400', 'bg-gradient-to-r', 'from-red-50', 'to-red-100', 'shadow-lg', 'scale-105');
                        item.classList.add('border-pink-200', 'from-pink-50', 'to-purple-50');
                    });
                    
                    // Chọn sự kiện hiện tại với hiệu ứng đẹp
                    eventElement.classList.remove('border-pink-200', 'from-pink-50', 'to-purple-50');
                    eventElement.classList.add('border-red-400', 'from-red-50', 'to-red-100', 'shadow-lg', 'scale-105');
                    
                    // Tìm chỉ số gốc của sự kiện trong mảng chưa sắp xếp
                    selectedEventIndex = events.findIndex(originalEvent => 
                        originalEvent.day === event.day && 
                        originalEvent.month === event.month && 
                        originalEvent.year === event.year && 
                        originalEvent.contdetl === event.contdetl
                    );
                    deleteBtn.disabled = false;
                    
                    // Cập nhật thông tin kỷ niệm cho sự kiện được chọn
                    updateAnniversaryInfoForSelectedEvent(event);
                    
                    // Chuyển lịch đến ngày của sự kiện được chọn (không cuộn)
                    if (event.day && event.month && event.year) {
                        const eventDate = new Date(event.year, event.month - 1, event.day);
                        window.calendarInstance.goToDateWithoutScroll(eventDate);
                    }
                });
                
                eventsContainer.appendChild(eventElement);
            });
        }

        // Hàm đọc dữ liệu danh sách sự kiện từ file
        async function readNotes() {
            try {
                const loadingSpinner = document.getElementById('loading-spinner');
                const eventsContainer = document.getElementById('eventsContainer');
                const emptyState = document.getElementById('emptyState');
                const errorMessage = document.getElementById('errorMessage');
                
                // Hiển thị loading
                loadingSpinner.classList.remove('hidden');
                eventsContainer.innerHTML = '';
                emptyState.classList.add('hidden');
                errorMessage.classList.add('hidden');
                
                const response = await fetch(API_BASE_URL, {
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Giải mã nội dung từ Base64
                const content = JSON.parse(base64Decode(data.content));
                loadingSpinner.classList.add('hidden');
                
                // Hiển thị danh sách sự kiện
                displayEvents(content);
                
                return { content, sha: data.sha };
            } catch (error) {
                console.error('Lỗi khi đọc ghi chú từ GitHub:', error);
                const loadingSpinner = document.getElementById('loading-spinner');
                const errorMessage = document.getElementById('errorMessage');
                
                loadingSpinner.classList.add('hidden');
                errorMessage.classList.remove('hidden');
                
                return { content: [], sha: null };
            }
        }

        class Calendar {
            constructor() {
                this.currentDate = new Date();
                this.today = new Date();
                this.selectedDate = null;
                this.monthNames = [
                    'Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
                    'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'
                ];
                this.dayNames = ['Chủ nhật', 'Thứ hai', 'Thứ ba', 'Thứ tư', 'Thứ năm', 'Thứ sáu', 'Thứ bảy'];
                
                // Events and anniversaries will be loaded from data
                this.events = new Set();
                this.anniversaries = new Set();
                
                this.init();
            }

            init() {
                this.render();
                this.bindEvents();
                this.updateTodayInfo();
            }

            bindEvents() {
                document.getElementById('prevMonth').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.render();
                });

                document.getElementById('nextMonth').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.render();
                });
            }

            render() {
                this.updateHeader();
                this.renderDays();
            }

            updateHeader() {
                const monthYear = `${this.monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
                document.getElementById('monthYear').textContent = monthYear;
                
                // Debug log
                console.log('Updating calendar for:', monthYear);
            }

            renderDays() {
                const calendarDays = document.getElementById('calendarDays');
                calendarDays.innerHTML = '';

                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                
                // Tính ngày đầu tiên của tháng
                const firstDay = new Date(year, month, 1);
                // Tính ngày bắt đầu hiển thị (Chủ nhật của tuần chứa ngày 1)
                const startDate = new Date(firstDay);
                startDate.setDate(firstDay.getDate() - firstDay.getDay());

                // Tạo 42 ô (6 tuần x 7 ngày)
                for (let i = 0; i < 42; i++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + i);
                    
                    // Debug log for first few dates
                    if (i < 7) {
                        console.log(`Day ${i}: ${currentDate.getDate()}/${currentDate.getMonth() + 1}/${currentDate.getFullYear()}`);
                    }
                    
                    const dayElement = this.createDayElement(currentDate, month);
                    calendarDays.appendChild(dayElement);
                }
            }

            createDayElement(date, currentMonth) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'p-1 md:p-2 text-center cursor-pointer min-h-[45px] md:min-h-[65px] lg:min-h-[70px] flex items-center justify-center relative';
                
                const dateCell = document.createElement('div');
                dateCell.className = 'date-cell';
                dateCell.textContent = date.getDate();
                
                const dateString = this.formatDate(date);
                
                // Check if it's today
                if (this.isSameDay(date, this.today)) {
                    dateCell.classList.add('today');
                }
                
                // Check if it's in current month
                if (date.getMonth() !== currentMonth) {
                    dateCell.classList.add('other-month');
                }
                
                // Check if it's weekend
                if (date.getDay() === 0 || date.getDay() === 6) {
                    dateCell.classList.add('weekend');
                }
                
                // Check for events
                if (this.events.has(dateString)) {
                    dateCell.classList.add('has-event');
                }
                
                // Check for anniversaries
                if (this.anniversaries.has(dateString)) {
                    dateCell.classList.add('anniversary');
                }
                
                // Add click event
                dateCell.addEventListener('click', () => {
                    // Remove previous selection
                    document.querySelectorAll('.date-cell.selected').forEach(cell => {
                        cell.classList.remove('selected');
                    });
                    
                    // Add selection to clicked date
                    dateCell.classList.add('selected');
                    this.selectedDate = new Date(date);
                });

                dayDiv.appendChild(dateCell);
                return dayDiv;
            }

            formatDate(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            }

            isSameDay(date1, date2) {
                return date1.getDate() === date2.getDate() &&
                       date1.getMonth() === date2.getMonth() &&
                       date1.getFullYear() === date2.getFullYear();
            }

            updateTodayInfo() {
                const todayString = `${this.dayNames[this.today.getDay()]}, ${this.today.getDate()}/${this.today.getMonth() + 1}/${this.today.getFullYear()}`;
                document.getElementById('todayDate').textContent = todayString;
            }

            goToToday() {
                this.currentDate = new Date();
                this.render();
            }

            goToDate(date) {
                this.currentDate = new Date(date);
                this.render();
                
                // Highlight ngày được chọn
                setTimeout(() => {
                    const targetDay = date.getDate();
                    const dateCells = document.querySelectorAll('.date-cell');
                    dateCells.forEach(cell => {
                        if (parseInt(cell.textContent) === targetDay && !cell.classList.contains('other-month')) {
                            cell.classList.add('selected');
                            cell.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    });
                }, 100);
            }

            goToDateWithoutScroll(date) {
                this.currentDate = new Date(date);
                this.render();
                
                // Highlight ngày được chọn nhưng không cuộn
                setTimeout(() => {
                    const targetDay = date.getDate();
                    const dateCells = document.querySelectorAll('.date-cell');
                    dateCells.forEach(cell => {
                        if (parseInt(cell.textContent) === targetDay && !cell.classList.contains('other-month')) {
                            cell.classList.add('selected');
                        }
                    });
                }, 100);
            }

            updateEventsFromData(events) {
                this.events.clear();
                this.anniversaries.clear();
                
                if (events && events.length > 0) {
                    events.forEach(event => {
                        if (event.day && event.month && event.year) {
                            const dateString = `${event.year}-${String(event.month).padStart(2, '0')}-${String(event.day).padStart(2, '0')}`;
                            this.events.add(dateString);
                            
                            // Kiểm tra nếu là sự kiện kỷ niệm (có thể dựa vào nội dung hoặc icon)
                            if (event.contdetl && (event.contdetl.toLowerCase().includes('kỷ niệm') || 
                                event.contdetl.toLowerCase().includes('anniversary') || 
                                event.icon === '❤️')) {
                                this.anniversaries.add(dateString);
                            }
                        }
                    });
                }
                
                // Re-render calendar to show updated events
                this.render();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const calendar = new Calendar();
            window.calendarInstance = calendar;
            

            
            // Tải danh sách sự kiện khi trang được tải
            readNotes().then(({ content }) => {
                if (content && content.length > 0) {
                    calendar.updateEventsFromData(content);
                }
            });
            
            // Tải ảnh từ Google Drive khi trang được tải
            loadPhotosFromDrive();
            
            // Thêm sự kiện cho nút làm mới sự kiện
            document.getElementById('refreshEvents').addEventListener('click', () => {
                readNotes().then(({ content }) => {
                    if (content && content.length > 0) {
                        calendar.updateEventsFromData(content);
                    }
                });
                calendar.goToToday();
            });

            // Thêm sự kiện cho nút làm mới ảnh
            document.getElementById('refreshPhotos').addEventListener('click', () => {
                loadPhotosFromDrive();
            });

            // Thêm sự kiện click vào vùng trống để bỏ chọn
            document.addEventListener('click', (e) => {
                // Kiểm tra nếu click không phải vào sự kiện hoặc các nút điều khiển
                if (!e.target.closest('.event-item') && 
                    !e.target.closest('#deleteEventBtn') && 
                    !e.target.closest('#addEventBtn') && 
                    !e.target.closest('#refreshEvents')) {
                    
                    // Bỏ chọn tất cả sự kiện
                    document.querySelectorAll('.event-item').forEach(item => {
                        item.classList.remove('border-red-400', 'bg-gradient-to-r', 'from-red-50', 'to-red-100', 'shadow-lg', 'scale-105');
                        item.classList.add('border-pink-200', 'from-pink-50', 'to-purple-50');
                    });
                    
                    // Reset selection
                    selectedEventIndex = -1;
                    document.getElementById('deleteEventBtn').disabled = true;
                    
                    // Khôi phục thông tin kỷ niệm về sự kiện gần nhất
                    updateAnniversaryInfo(currentEventsData);
                }
            });

            // Xử lý sự kiện khi nhấn nút "Xóa Sự Kiện"
            document.getElementById('deleteEventBtn').addEventListener('click', () => {
                if (selectedEventIndex === -1) {
                    showMessage('Vui lòng chọn sự kiện cần xóa.', 'error');
                    return;
                }

                const selectedEvent = currentEventsData[selectedEventIndex];
                const day = String(selectedEvent.day).padStart(2, '0');
                const month = String(selectedEvent.month).padStart(2, '0');
                const formattedDate = `${day}/${month}/${selectedEvent.year}`;
                const eventContent = selectedEvent.contdetl || 'Không có nội dung';
                
                // Hiển thị thông tin sự kiện trong modal xác nhận
                document.getElementById('eventToDelete').innerHTML = `
                    <strong>${formattedDate}:</strong> ${eventContent}
                `;
                
                // Hiển thị modal xác nhận
                const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
                deleteModal.show();
            });

            // Xử lý sự kiện khi nhấn nút xác nhận xóa
            document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
                const confirmBtn = document.getElementById('confirmDeleteBtn');
                const deleteSpinner = document.getElementById('deleteSpinner');
                
                // Hiển thị loading
                confirmBtn.disabled = true;
                deleteSpinner.classList.remove('d-none');

                try {
                    await deleteEvent(selectedEventIndex);
                    
                    // Đóng modal
                    const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
                    deleteModal.hide();
                    
                    // Reset selection
                    selectedEventIndex = -1;
                    document.getElementById('deleteEventBtn').disabled = true;
                    
                } catch (error) {
                    console.error('Lỗi khi xóa sự kiện:', error);
                    showMessage('Lỗi khi xóa sự kiện. Vui lòng thử lại.', 'error');
                } finally {
                    // Ẩn loading
                    confirmBtn.disabled = false;
                    deleteSpinner.classList.add('d-none');
                }
            });

            // Xử lý sự kiện khi nhấn nút "Lưu Sự Kiện"
            document.getElementById('saveEventBtn').addEventListener('click', async () => {
                const eventDate = document.getElementById('eventDate').value;
                const eventContent = document.getElementById('eventContent').value.trim();
                const eventColor = document.querySelector('input[name="eventColor"]:checked').value;
                const eventIcon = document.querySelector('input[name="eventIcon"]:checked').value;
                const eventImageFolder = document.getElementById('eventImageFolder').value.trim();

                if (!eventDate || !eventContent) {
                    showMessage('Vui lòng nhập ngày và nội dung sự kiện.', 'error');
                    return;
                }

                const saveBtn = document.getElementById('saveEventBtn');
                const saveSpinner = document.getElementById('saveSpinner');
                
                // Hiển thị loading
                saveBtn.disabled = true;
                saveSpinner.classList.remove('d-none');

                try {
                    // Đọc dữ liệu hiện tại
                    const { content: currentEvents, sha } = await readNotes();

                    // Chuyển đổi ngày từ YYYY-MM-DD sang DD/MM/YYYY
                    const dateParts = eventDate.split('-');
                    const day = parseInt(dateParts[2]);
                    const month = parseInt(dateParts[1]);
                    const year = parseInt(dateParts[0]);

                    // Tạo sự kiện mới
                    const newEvent = {
                        day: day,
                        month: month,
                        year: year,
                        contdetl: eventContent,
                        colorClass: eventColor,
                        icon: eventIcon,
                        URL: eventImageFolder || '',
                        date: new Date().toISOString()
                    };
                    
                    // Thêm sự kiện mới vào mảng
                    currentEvents.push(newEvent);
                    
                    // Ghi lại mảng đã cập nhật
                    await writeNotes(currentEvents, sha);

                    // Cập nhật giao diện
                    displayEvents(currentEvents);
                    calendar.updateEventsFromData(currentEvents);
                    showMessage('Sự kiện đã được lưu thành công! 🎉');

                    // Đóng modal và reset form
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addEventModal'));
                    modal.hide();
                    document.getElementById('addEventForm').reset();
                    
                    // Reset các radio button về mặc định
                    document.getElementById('color-pink').checked = true;
                    document.getElementById('icon-heart').checked = true;

                } catch (error) {
                    console.error('Lỗi khi lưu sự kiện:', error);
                    showMessage('Lỗi khi lưu sự kiện. Vui lòng thử lại.', 'error');
                } finally {
                    // Ẩn loading
                    saveBtn.disabled = false;
                    saveSpinner.classList.add('d-none');
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97de9644527e6e46',t:'MTc1NzY3MTUzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
