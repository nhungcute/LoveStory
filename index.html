<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Story üíï</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap');
        
        body {
            box-sizing: border-box;
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #FFF5F7 0%, #FFE8ED 50%, #FFF0F5 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        .calendar-container {
            background: linear-gradient(145deg, #ffffff 0%, #fef7ff 100%);
            border-radius: 20px;
            box-shadow: 
                0 20px 40px rgba(252, 189, 210, 0.3),
                0 0 0 1px rgba(255, 182, 193, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            overflow: hidden;
            width: 90vw;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .today-info {
            background: linear-gradient(145deg, #ffffff 0%, #fef7ff 100%);
            border: 2px solid #FFE0E8;
            border-radius: 20px;
            box-shadow: 
                0 8px 25px rgba(252, 189, 210, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        /* Photo Modal Styles */
        #photoModal .modal-dialog {
            margin: 0;
            width: 100vw;
            height: 100vh;
            max-width: none;
        }
        
        #photoModal .modal-content {
            border-radius: 0;
        }
        
        /* Loading spinner */
        .spinner-border {
            width: 2rem;
            height: 2rem;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Main Content -->
    <div class="w-full mx-auto relative z-10">
        <!-- Today's Info -->
        <div class="mt-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 w-[90%] max-w-[1200px] mx-auto">
                <div class="today-info px-6 py-4 min-h-[120px] flex flex-col justify-center text-center">
                    <p class="text-gray-600 text-sm">H√¥m nay</p>
                    <p id="todayDate" class="text-lg font-bold text-gray-800"></p>
                </div>
                <div id="anniversaryInfo" class="today-info px-6 py-4 bg-gradient-to-r from-pink-50 to-red-50 border-pink-300 min-h-[120px] flex flex-col justify-center text-center">
                    <p id="anniversaryLabel" class="text-pink-600 text-sm">K·ªâ ni·ªám s·∫Øp t·ªõi</p>
                    <p id="anniversaryDate" class="text-lg font-bold text-pink-800"></p>
                    <p id="daysLeft" class="text-sm text-pink-600 mt-1"></p>
                    <p id="anniversaryYears" class="text-xs text-pink-500"></p>
                </div>
            </div>
        </div>

        <!-- Newsfeed Section -->
        <div class="mt-8 flex justify-center">
            <div class="calendar-container mx-auto">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üì∏ Kho·∫£nh Kh·∫Øc ƒê√°ng Y√™u</h3>
                        <button id="uploadMetadataBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="bi bi-cloud-upload me-1"></i>
                            C·∫≠p nh·∫≠t ·∫£nh
                        </button>
                    </div>
                    
                    <!-- Loading Spinner for Photos -->
                    <div id="photos-loading-spinner" class="flex justify-center items-center py-8">
                        <div class="spinner-border text-pink-500" role="status">
                            <span class="visually-hidden">ƒêang t·∫£i...</span>
                        </div>
                        <span class="ml-2 text-gray-600">ƒêang t·∫£i ·∫£nh...</span>
                    </div>
                    
                    <!-- Photos Grid -->
                    <div id="photosGrid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6" style="display: none;">
                        <!-- Photos will be loaded here -->
                    </div>
                    
                    <!-- Pagination Controls -->
                    <div id="paginationControls" class="hidden mt-8 flex flex-col sm:flex-row items-center justify-between gap-4">
                        <div class="text-sm text-gray-600">
                            Hi·ªÉn th·ªã <span id="currentRange"></span> trong t·ªïng s·ªë <span id="totalPhotos"></span> ·∫£nh
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <button id="firstPageBtn" class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                <i class="bi bi-chevron-double-left"></i>
                            </button>
                            <button id="prevPageBtn" class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                <i class="bi bi-chevron-left"></i>
                            </button>
                            
                            <div class="flex items-center gap-1" id="pageNumbers">
                                <!-- Page numbers will be generated here -->
                            </div>
                            
                            <button id="nextPageBtn" class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                            <button id="lastPageBtn" class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                <i class="bi bi-chevron-double-right"></i>
                            </button>
                        </div>
                        
                        <div class="text-sm text-gray-600">
                            Trang <span id="currentPageDisplay"></span> / <span id="totalPagesDisplay"></span>
                        </div>
                    </div>
                    
                    <!-- Empty State for Photos -->
                    <div id="photosEmptyState" class="hidden text-center py-8 text-gray-500">
                        <p>üì∑ Ch∆∞a c√≥ ·∫£nh n√†o</p>
                    </div>
                    
                    <!-- Error Message for Photos -->
                    <div id="photosErrorMessage" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">
                        <p>‚ùå Kh√¥ng th·ªÉ t·∫£i danh s√°ch ·∫£nh</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Modal -->
    <div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="photoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen-lg-down modal-xl modal-dialog-centered">
            <div class="modal-content bg-transparent border-0 h-100">
                <!-- Header -->
                <div class="modal-header border-0 position-absolute w-100 d-flex justify-content-between align-items-center p-3" style="top: 0; left: 0; z-index: 1060; background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 50%, transparent 100%);">
                    <h5 id="photoModalTitle" class="modal-title text-white fw-bold m-0"></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Body -->
                <div class="modal-body p-0 d-flex align-items-center justify-content-center h-100 position-relative" style="background: rgba(0,0,0,0.9);">
                    <!-- Loading spinner -->
                    <div id="imageLoadingSpinner" class="position-absolute d-flex flex-column align-items-center justify-content-center text-white">
                        <div class="spinner-border text-light mb-3" role="status">
                            <span class="visually-hidden">ƒêang t·∫£i...</span>
                        </div>
                        <p class="text-center">ƒêang t·∫£i ·∫£nh...</p>
                    </div>
                    
                    <!-- ·∫¢nh ch√≠nh -->
                    <img id="modalImage" src="" alt="Photo" class="img-fluid d-none" 
                         style="max-height: 90vh; max-width: 95vw; object-fit: contain;"
                         onload="handleImageLoad()" 
                         onerror="handleImageError()">
                    
                    <!-- Th√¥ng b√°o l·ªói -->
                    <div id="imageErrorMessage" class="d-none text-center text-white">
                        <div class="mb-3">
                            <i class="bi bi-exclamation-triangle" style="font-size: 3rem;"></i>
                        </div>
                        <h5>Kh√¥ng th·ªÉ t·∫£i ·∫£nh</h5>
                        <p class="text-muted">Vui l√≤ng th·ª≠ l·∫°i sau</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let CONFIG = {};
        let GITHUB_USERNAME, REPO_NAME, PAT, PHOTOS_METADATA_FILE_PATH, PHOTOS_METADATA_API_URL;
        let FOLDER_ID, API_KEY, PHOTOS_PER_PAGE;
        let allPhotosData = [];
        let currentPage = 1;
        let totalPages = 1;
        let isLoadingPhotos = false;

        // H√†m t·∫£i c·∫•u h√¨nh
        async function loadConfig() {
            try {
                const response = await fetch('./configApp.json', { cache: 'no-cache' });
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                CONFIG = await response.json();
                
                // Thi·∫øt l·∫≠p c√°c bi·∫øn t·ª´ config
                GITHUB_USERNAME = CONFIG.GITHUB_USERNAME;
                REPO_NAME = CONFIG.REPO_NAME;
                PAT = CONFIG.PAT1 + CONFIG.PAT2;
                PHOTOS_METADATA_FILE_PATH = CONFIG.PHOTOS_METADATA_FILE_PATH || 'photos_metadata.json';
                PHOTOS_METADATA_API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${PHOTOS_METADATA_FILE_PATH}`;
                
                FOLDER_ID = CONFIG.FOLDER_ID || '';
                API_KEY = CONFIG.API_KEY || '';
                PHOTOS_PER_PAGE = CONFIG.PHOTOS_PER_PAGE || 12;
                
                return true;
            } catch (error) {
                showMessage('‚ùå Kh√¥ng th·ªÉ t·∫£i c·∫•u h√¨nh ·ª©ng d·ª•ng', 'error');
                throw error;
            }
        }

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o
        function showMessage(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info'} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
            
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // H√†m encode/decode base64
        function base64Encode(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }

        function base64Decode(str) {
            return decodeURIComponent(escape(atob(str)));
        }

        // H√†m x·ª≠ l√Ω ·∫£nh
        function handleImageLoad() {
            const loadingSpinner = document.getElementById('imageLoadingSpinner');
            const modalImage = document.getElementById('modalImage');
            const errorMessage = document.getElementById('imageErrorMessage');
            
            if (loadingSpinner) loadingSpinner.classList.add('d-none');
            if (modalImage) modalImage.classList.remove('d-none');
            if (errorMessage) errorMessage.classList.add('d-none');
        }

        function handleImageError() {
            const loadingSpinner = document.getElementById('imageLoadingSpinner');
            const modalImage = document.getElementById('modalImage');
            const errorMessage = document.getElementById('imageErrorMessage');
            
            if (loadingSpinner) loadingSpinner.classList.add('d-none');
            if (modalImage) modalImage.classList.add('d-none');
            if (errorMessage) errorMessage.classList.remove('d-none');
        }

        // H√†m ƒë·ªçc metadata ·∫£nh
        async function readPhotosMetadata() {
            try {
                const response = await fetch(PHOTOS_METADATA_API_URL, {
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        return { content: [], sha: null };
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                let content = [];
                
                try {
                    const decodedContent = base64Decode(data.content);
                    if (decodedContent.trim()) {
                        content = JSON.parse(decodedContent);
                    }
                } catch (parseError) {
                    console.warn('L·ªói parse JSON metadata:', parseError);
                    content = [];
                }
                
                if (!Array.isArray(content)) {
                    content = [];
                }
                
                return { content, sha: data.sha };
            } catch (error) {
                console.error('L·ªói khi ƒë·ªçc metadata t·ª´ GitHub:', error);
                return { content: [], sha: null };
            }
        }

        // H√†m ghi metadata ·∫£nh
        async function writePhotosMetadata(photosArray) {
            try {
                const content = JSON.stringify(photosArray, null, 2);
                const encodedContent = base64Encode(content);

                const now = new Date();
                const vietnamTime = new Date(now.getTime() + (7 * 60 * 60 * 1000));
                const timeString = vietnamTime.toLocaleString('vi-VN');

                let currentSha = null;
                try {
                    const currentResponse = await fetch(PHOTOS_METADATA_API_URL, {
                        headers: {
                            'Authorization': `token ${PAT}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (currentResponse.ok) {
                        const currentData = await currentResponse.json();
                        currentSha = currentData.sha;
                    }
                } catch (shaError) {
                    console.log('Kh√¥ng th·ªÉ l·∫•y SHA hi·ªán t·∫°i');
                }

                const body = JSON.stringify({
                    message: `C·∫≠p nh·∫≠t metadata ·∫£nh - ${timeString}`,
                    content: encodedContent,
                    ...(currentSha && { sha: currentSha })
                });

                const response = await fetch(PHOTOS_METADATA_API_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${PAT}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: body
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                console.log('ƒê√£ ghi metadata th√†nh c√¥ng l√™n GitHub');
                return await response.json();
            } catch (error) {
                console.error('L·ªói khi ghi metadata l√™n GitHub:', error);
                throw error;
            }
        }

        // H√†m upload metadata ·∫£nh
        async function uploadPhotosMetadata() {
            if (isLoadingPhotos) return;
            isLoadingPhotos = true;
            
            const uploadBtn = document.getElementById('uploadMetadataBtn');
            const loadingSpinner = document.getElementById('photos-loading-spinner');
            const photosGrid = document.getElementById('photosGrid');
            const emptyState = document.getElementById('photosEmptyState');
            const errorMessage = document.getElementById('photosErrorMessage');
            
            try {
                // Hi·ªÉn th·ªã loading
                loadingSpinner.style.display = 'flex';
                photosGrid.style.display = 'none';
                emptyState.classList.add('hidden');
                errorMessage.classList.add('hidden');
                if (uploadBtn) uploadBtn.disabled = true;
                
                // T·∫£i ·∫£nh t·ª´ Google Drive
                const url = `https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents+and+mimeType+contains+'image/'&key=${API_KEY}&fields=files(id,name,webViewLink,thumbnailLink,webContentLink,createdTime,modifiedTime,size)&pageSize=1000`;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const allFiles = data.files || [];
                
                // L∆∞u metadata l√™n GitHub
                await writePhotosMetadata(allFiles);
                
                // C·∫≠p nh·∫≠t d·ªØ li·ªáu local
                allPhotosData = allFiles;
                totalPages = Math.ceil(allPhotosData.length / PHOTOS_PER_PAGE);
                currentPage = 1;
                
                loadingSpinner.style.display = 'none';
                
                if (allPhotosData.length === 0) {
                    emptyState.classList.remove('hidden');
                    showMessage('Kh√¥ng t√¨m th·∫•y ·∫£nh n√†o trong folder!', 'error');
                    return;
                }
                
                // Hi·ªÉn th·ªã trang ƒë·∫ßu ti√™n
                displayPhotosPage(1);
                updatePaginationControls();
                photosGrid.style.display = 'grid';
                
                showMessage(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√†nh c√¥ng ${allFiles.length} ·∫£nh!`, 'success');
                
            } catch (error) {
                console.error('L·ªói khi upload metadata:', error);
                loadingSpinner.style.display = 'none';
                errorMessage.classList.remove('hidden');
                
                let errorMsg = 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch ·∫£nh';
                if (error.message.includes('403')) {
                    errorMsg = 'Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p Google Drive API';
                } else if (error.message.includes('404')) {
                    errorMsg = 'Kh√¥ng t√¨m th·∫•y folder ho·∫∑c API key kh√¥ng h·ª£p l·ªá';
                }
                
                showMessage(errorMsg, 'error');
            } finally {
                isLoadingPhotos = false;
                if (uploadBtn) uploadBtn.disabled = false;
            }
        }

        // H√†m hi·ªÉn th·ªã trang ·∫£nh
        function displayPhotosPage(page) {
            const photosGrid = document.getElementById('photosGrid');
            if (!photosGrid || !allPhotosData.length) return;
            
            const startIndex = (page - 1) * PHOTOS_PER_PAGE;
            const endIndex = startIndex + PHOTOS_PER_PAGE;
            const pagePhotos = allPhotosData.slice(startIndex, endIndex);
            
            photosGrid.innerHTML = '';
            
            pagePhotos.forEach((photo, index) => {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300';
                
                const globalIndex = startIndex + index;
                
                photoDiv.innerHTML = `
                    <div class="relative">
                        <img src="${photo.thumbnailLink}" alt="${photo.name}" 
                             class="w-full h-48 object-cover cursor-pointer"
                             onclick="openPhotoModal('${photo.id}', '${photo.name}', '${photo.webViewLink}', '${photo.webContentLink}', '${photo.createdTime}')"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5YTNhZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkzhu5dpIHThuqNpIOG6o25oPC90ZXh0Pjwvc3ZnPg=='">
                        <div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm">
                            ${globalIndex + 1}
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-gray-800 mb-2 truncate">${photo.name}</h3>
                        <p class="text-sm text-gray-600 mb-3">
                            üìÖ ${new Date(photo.createdTime).toLocaleDateString('vi-VN')}
                        </p>
                    </div>
                `;
                
                photosGrid.appendChild(photoDiv);
            });
        }

        // H√†m c·∫≠p nh·∫≠t ph√¢n trang
        function updatePaginationControls() {
            const paginationControls = document.getElementById('paginationControls');
            if (!paginationControls) return;
            
            if (allPhotosData.length === 0) {
                paginationControls.classList.add('hidden');
                return;
            }
            
            paginationControls.classList.remove('hidden');
            
            const startIndex = (currentPage - 1) * PHOTOS_PER_PAGE + 1;
            const endIndex = Math.min(currentPage * PHOTOS_PER_PAGE, allPhotosData.length);
            
            const currentRange = document.getElementById('currentRange');
            const totalPhotosSpan = document.getElementById('totalPhotos');
            const currentPageDisplay = document.getElementById('currentPageDisplay');
            const totalPagesDisplay = document.getElementById('totalPagesDisplay');
            
            if (currentRange) currentRange.textContent = `${startIndex}-${endIndex}`;
            if (totalPhotosSpan) totalPhotosSpan.textContent = allPhotosData.length;
            if (currentPageDisplay) currentPageDisplay.textContent = currentPage;
            if (totalPagesDisplay) totalPagesDisplay.textContent = totalPages;
            
            // C·∫≠p nh·∫≠t n√∫t
            const firstBtn = document.getElementById('firstPageBtn');
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            const lastBtn = document.getElementById('lastPageBtn');
            
            if (firstBtn) firstBtn.disabled = currentPage === 1;
            if (prevBtn) prevBtn.disabled = currentPage === 1;
            if (nextBtn) nextBtn.disabled = currentPage === totalPages;
            if (lastBtn) lastBtn.disabled = currentPage === totalPages;
        }

        // H√†m chuy·ªÉn trang
        function goToPage(page) {
            if (page < 1 || page > totalPages || page === currentPage) return;
            
            currentPage = page;
            displayPhotosPage(currentPage);
            updatePaginationControls();
        }

        // H√†m m·ªü modal ·∫£nh
        function openPhotoModal(photoId, photoName, webViewLink, webContentLink, createdTime) {
            const modal = new bootstrap.Modal(document.getElementById('photoModal'));
            const modalTitle = document.getElementById('photoModalTitle');
            const modalImage = document.getElementById('modalImage');
            const loadingSpinner = document.getElementById('imageLoadingSpinner');
            const errorMessage = document.getElementById('imageErrorMessage');
            
            // Reset modal state
            modalImage.classList.add('d-none');
            loadingSpinner.classList.remove('d-none');
            errorMessage.classList.add('d-none');
            
            // Set title
            if (modalTitle) modalTitle.textContent = photoName;
            
            // Set image source
            if (modalImage) {
                modalImage.src = webContentLink || webViewLink;
            }
            
            modal.show();
        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await loadConfig();
                
                // Hi·ªÉn th·ªã ng√†y h√¥m nay
                const todayDate = document.getElementById('todayDate');
                if (todayDate) {
                    const now = new Date();
                    todayDate.textContent = now.toLocaleDateString('vi-VN', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                }
                
                // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
                const { content: photosMetadata } = await readPhotosMetadata();
                if (Array.isArray(photosMetadata) && photosMetadata.length > 0) {
                    allPhotosData = photosMetadata;
                    totalPages = Math.ceil(allPhotosData.length / PHOTOS_PER_PAGE);
                    
                    displayPhotosPage(1);
                    updatePaginationControls();
                    
                    document.getElementById('photos-loading-spinner').style.display = 'none';
                    document.getElementById('photosGrid').style.display = 'grid';
                } else {
                    document.getElementById('photos-loading-spinner').style.display = 'none';
                    document.getElementById('photosEmptyState').classList.remove('hidden');
                }
                
                // Setup event listeners
                const uploadBtn = document.getElementById('uploadMetadataBtn');
                if (uploadBtn) uploadBtn.onclick = uploadPhotosMetadata;
                
                const firstBtn = document.getElementById('firstPageBtn');
                const prevBtn = document.getElementById('prevPageBtn');
                const nextBtn = document.getElementById('nextPageBtn');
                const lastBtn = document.getElementById('lastPageBtn');
                
                if (firstBtn) firstBtn.onclick = () => goToPage(1);
                if (prevBtn) prevBtn.onclick = () => goToPage(currentPage - 1);
                if (nextBtn) nextBtn.onclick = () => goToPage(currentPage + 1);
                if (lastBtn) lastBtn.onclick = () => goToPage(totalPages);
                
                console.log('‚úÖ ·ª®ng d·ª•ng ƒë√£ kh·ªüi t·∫°o th√†nh c√¥ng');
                
            } catch (error) {
                console.error('‚ùå L·ªói kh·ªüi t·∫°o ·ª©ng d·ª•ng:', error);
                showMessage('Kh√¥ng th·ªÉ kh·ªüi t·∫°o ·ª©ng d·ª•ng. Vui l√≤ng ki·ªÉm tra c·∫•u h√¨nh.', 'error');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'987aa1dba1500447',t:'MTc1OTMwNzc4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
